(function(window,undefined){var freeExports=typeof exports=='object'&&exports,freeModule=typeof module=='object'&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal;}
var Rx={Internals:{}};function noop(){}
function identity(x){return x;}
function defaultNow(){return new Date().getTime();}
function defaultComparer(x,y){return isEqual(x,y);}
function defaultSubComparer(x,y){return x-y;}
function defaultKeySerializer(x){return x.toString();}
function defaultError(err){throw err;}
var sequenceContainsNoElements='Sequence contains no elements.';var argumentOutOfRange='Argument out of range';var objectDisposed='Object has been disposed';function checkDisposed(){if(this.isDisposed){throw new Error(objectDisposed);}}
var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',errorClass='[object Error]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,supportsArgsClass=toString.call(arguments)==argsClass,suportNodeClass;try{suportNodeClass=!(toString.call(document)==objectClass&&!({'toString':0}+''));}catch(e){suportNodeClass=true;}
function isNode(value){return typeof value.toString!='function'&&typeof(value+'')=='string';}
function isArguments(value){return(value&&typeof value=='object')?toString.call(value)==argsClass:false;}
if(!supportsArgsClass){isArguments=function(value){return(value&&typeof value=='object')?hasOwnProperty.call(value,'callee'):false;};}
function isFunction(value){return typeof value=='function';}
if(isFunction(/x/)){isFunction=function(value){return typeof value=='function'&&toString.call(value)==funcClass;};}
var isEqual=Rx.Internals.isEqual=function(x,y){return deepEquals(x,y,[],[]);};function deepEquals(a,b,stackA,stackB){var result;if(a===b){return a!==0||(1/a==1/b);}
var type=typeof a,otherType=typeof b;if(a===a&&!(a&&objectTypes[type])&&!(b&&objectTypes[otherType])){return false;}
if(a==null||b==null){return a===b;}
var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass;}
if(otherClass==argsClass){otherClass=objectClass;}
if(className!=otherClass){return false;}
switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return(a!=+a)?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==String(b);}
var isArr=className==arrayClass;if(!isArr){if(className!=objectClass||(!suportNodeClass&&(isNode(a)||isNode(b)))){return false;}
var ctorA=!supportsArgsClass&&isArguments(a)?Object:a.constructor,ctorB=!supportsArgsClass&&isArguments(b)?Object:b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)){return false;}}
var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b;}}
var size=0;result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==a.length;while(size--){var index=length,value=b[size];if(!(result=deepEquals(a[size],value,stackA,stackB))){break;}}
return result;}
for(var key in b){if(hasOwnProperty.call(b,key)){size++;return(result=hasOwnProperty.call(a,key)&&deepEquals(a[key],b[key],stackA,stackB));}}
if(result){for(var key in a){if(hasOwnProperty.call(a,key)){return(result=--size>-1);}}}
stackA.pop();stackB.pop();return result;}
var slice=Array.prototype.slice;function argsOrArray(args,idx){return args.length===1&&Array.isArray(args[idx])?args[idx]:slice.call(args);}
var hasProp={}.hasOwnProperty;var inherits=this.inherits=Rx.Internals.inherits=function(child,parent){function __(){this.constructor=child;}
__.prototype=parent.prototype;child.prototype=new __();};var addProperties=Rx.Internals.addProperties=function(obj){var sources=slice.call(arguments,1);for(var i=0,len=sources.length;i<len;i++){var source=sources[i];for(var prop in source){obj[prop]=source[prop];}}};var addRef=Rx.Internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new CompositeDisposable(r.getDisposable(),xs.subscribe(observer));});};function arrayInitialize(count,factory){var a=new Array(count);for(var i=0;i<count;i++){a[i]=factory();}
return a;}
if(!Function.prototype.bind){Function.prototype.bind=function(that){var target=this,args=slice.call(arguments,1);var bound=function(){if(this instanceof bound){function F(){}
F.prototype=target.prototype;var self=new F();var result=target.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result){return result;}
return self;}else{return target.apply(that,args.concat(slice.call(arguments)));}};return bound;};}
var boxedString=Object("a"),splitString=boxedString[0]!="a"||!(0 in boxedString);if(!Array.prototype.every){Array.prototype.every=function every(fun){var object=Object(this),self=splitString&&{}.toString.call(this)=="[object String]"?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if({}.toString.call(fun)!="[object Function]"){throw new TypeError(fun+" is not a function");}
for(var i=0;i<length;i++){if(i in self&&!fun.call(thisp,self[i],i,object)){return false;}}
return true;};}
if(!Array.prototype.map){Array.prototype.map=function map(fun){var object=Object(this),self=splitString&&{}.toString.call(this)=="[object String]"?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if({}.toString.call(fun)!="[object Function]"){throw new TypeError(fun+" is not a function");}
for(var i=0;i<length;i++){if(i in self)
result[i]=fun.call(thisp,self[i],i,object);}
return result;};}
if(!Array.prototype.filter){Array.prototype.filter=function(predicate){var results=[],item,t=new Object(this);for(var i=0,len=t.length>>>0;i<len;i++){item=t[i];if(i in t&&predicate.call(arguments[1],item,i,t)){results.push(item);}}
return results;};}
if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)=='[object Array]';};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function indexOf(searchElement){var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!==n){n=0;}else if(n!==0&&n!=Infinity&&n!==-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;};}
var IndexedItem=function(id,value){this.id=id;this.value=value;};IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);if(c===0){c=this.id-other.id;}
return c;};var PriorityQueue=function(capacity){this.items=new Array(capacity);this.length=0;};var priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0;};priorityProto.percolate=function(index){if(index>=this.length||index<0){return;}
var parent=index-1>>1;if(parent<0||parent===index){return;}
if(this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent];this.items[parent]=temp;this.percolate(parent);}};priorityProto.heapify=function(index){if(index===undefined){index=0;}
if(index>=this.length||index<0){return;}
var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)){first=left;}
if(right<this.length&&this.isHigherPriority(right,first)){first=right;}
if(first!==index){var temp=this.items[index];this.items[index]=this.items[first];this.items[first]=temp;this.heapify(first);}};priorityProto.peek=function(){return this.items[0].value;};priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length];delete this.items[this.length];this.heapify();};priorityProto.dequeue=function(){var result=this.peek();this.removeAt(0);return result;};priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem(PriorityQueue.count++,item);this.percolate(index);};priorityProto.remove=function(item){for(var i=0;i<this.length;i++){if(this.items[i].value===item){this.removeAt(i);return true;}}
return false;};PriorityQueue.count=0;var CompositeDisposable=Rx.CompositeDisposable=function(){this.disposables=argsOrArray(arguments,0);this.isDisposed=false;this.length=this.disposables.length;};var CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){if(this.isDisposed){item.dispose();}else{this.disposables.push(item);this.length++;}};CompositeDisposablePrototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);this.length--;item.dispose();}}
return shouldDispose;};CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var currentDisposables=this.disposables.slice(0);this.disposables=[];this.length=0;for(var i=0,len=currentDisposables.length;i<len;i++){currentDisposables[i].dispose();}}};CompositeDisposablePrototype.clear=function(){var currentDisposables=this.disposables.slice(0);this.disposables=[];this.length=0;for(var i=0,len=currentDisposables.length;i<len;i++){currentDisposables[i].dispose();}};CompositeDisposablePrototype.contains=function(item){return this.disposables.indexOf(item)!==-1;};CompositeDisposablePrototype.toArray=function(){return this.disposables.slice(0);};var Disposable=Rx.Disposable=function(action){this.isDisposed=false;this.action=action||noop;};Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true;}};var disposableCreate=Disposable.create=function(action){return new Disposable(action);};var disposableEmpty=Disposable.empty={dispose:noop};var SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null;};var SingleAssignmentDisposablePrototype=SingleAssignmentDisposable.prototype;SingleAssignmentDisposablePrototype.disposable=function(value){return!value?this.getDisposable():this.setDisposable(value);};SingleAssignmentDisposablePrototype.getDisposable=function(){return this.current;};SingleAssignmentDisposablePrototype.setDisposable=function(value){if(this.current){throw new Error('Disposable has already been assigned');}
var shouldDispose=this.isDisposed;if(!shouldDispose){this.current=value;}
if(shouldDispose&&value){value.dispose();}};SingleAssignmentDisposablePrototype.dispose=function(){var old;if(!this.isDisposed){this.isDisposed=true;old=this.current;this.current=null;}
if(old){old.dispose();}};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=false;this.current=null;};SerialDisposable.prototype.getDisposable=function(){return this.current;};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed,old;if(!shouldDispose){old=this.current;this.current=value;}
if(old){old.dispose();}
if(shouldDispose&&value){value.dispose();}};SerialDisposable.prototype.disposable=function(value){if(!value){return this.getDisposable();}else{this.setDisposable(value);}};SerialDisposable.prototype.dispose=function(){var old;if(!this.isDisposed){this.isDisposed=true;old=this.current;this.current=null;}
if(old){old.dispose();}};var RefCountDisposable=Rx.RefCountDisposable=(function(){function InnerDisposable(disposable){this.disposable=disposable;this.disposable.count++;this.isInnerDisposed=false;}
InnerDisposable.prototype.dispose=function(){if(!this.disposable.isDisposed){if(!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose();}}}};function RefCountDisposable(disposable){this.underlyingDisposable=disposable;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0;}
RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed){if(!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose();}}}};RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this);};return RefCountDisposable;})();function ScheduledDisposable(scheduler,disposable){this.scheduler=scheduler,this.disposable=disposable,this.isDisposed=false;}
ScheduledDisposable.prototype.dispose=function(){var parent=this;this.scheduler.schedule(function(){if(!parent.isDisposed){parent.isDisposed=true;parent.disposable.dispose();}});};function ScheduledItem(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler;this.state=state;this.action=action;this.dueTime=dueTime;this.comparer=comparer||defaultSubComparer;this.disposable=new SingleAssignmentDisposable();}
ScheduledItem.prototype.invoke=function(){this.disposable.disposable(this.invokeCore());};ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime);};ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed;};ScheduledItem.prototype.invokeCore=function(){return this.action(this.scheduler,this.state);};var Scheduler=Rx.Scheduler=(function(){function Scheduler(now,schedule,scheduleRelative,scheduleAbsolute){this.now=now;this._schedule=schedule;this._scheduleRelative=scheduleRelative;this._scheduleAbsolute=scheduleAbsolute;}
function invokeRecImmediate(scheduler,pair){var state=pair.first,action=pair.second,group=new CompositeDisposable(),recursiveAction=function(state1){action(state1,function(state2){var isAdded=false,isDone=false,d=scheduler.scheduleWithState(state2,function(scheduler1,state3){if(isAdded){group.remove(d);}else{isDone=true;}
recursiveAction(state3);return disposableEmpty;});if(!isDone){group.add(d);isAdded=true;}});};recursiveAction(state);return group;}
function invokeRecDate(scheduler,pair,method){var state=pair.first,action=pair.second,group=new CompositeDisposable(),recursiveAction=function(state1){action(state1,function(state2,dueTime1){var isAdded=false,isDone=false,d=scheduler[method].call(scheduler,state2,dueTime1,function(scheduler1,state3){if(isAdded){group.remove(d);}else{isDone=true;}
recursiveAction(state3);return disposableEmpty;});if(!isDone){group.add(d);isAdded=true;}});};recursiveAction(state);return group;}
function invokeAction(scheduler,action){action();return disposableEmpty;}
var schedulerProto=Scheduler.prototype;schedulerProto.catchException=function(handler){return new CatchScheduler(this,handler);};schedulerProto.schedulePeriodic=function(period,action){return this.schedulePeriodicWithState(null,period,function(){action();});};schedulerProto.schedulePeriodicWithState=function(state,period,action){var s=state,id=window.setInterval(function(){s=action(s);},period);return disposableCreate(function(){window.clearInterval(id);});};schedulerProto.schedule=function(action){return this._schedule(action,invokeAction);};schedulerProto.scheduleWithState=function(state,action){return this._schedule(state,action);};schedulerProto.scheduleWithRelative=function(dueTime,action){return this._scheduleRelative(action,dueTime,invokeAction);};schedulerProto.scheduleWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative(state,dueTime,action);};schedulerProto.scheduleWithAbsolute=function(dueTime,action){return this._scheduleAbsolute(action,dueTime,invokeAction);};schedulerProto.scheduleWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute(state,dueTime,action);};schedulerProto.scheduleRecursive=function(action){return this.scheduleRecursiveWithState(action,function(_action,self){_action(function(){self(_action);});});};schedulerProto.scheduleRecursiveWithState=function(state,action){return this.scheduleWithState({first:state,second:action},function(s,p){return invokeRecImmediate(s,p);});};schedulerProto.scheduleRecursiveWithRelative=function(dueTime,action){return this.scheduleRecursiveWithRelativeAndState(action,dueTime,function(_action,self){_action(function(dt){self(_action,dt);});});};schedulerProto.scheduleRecursiveWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative({first:state,second:action},dueTime,function(s,p){return invokeRecDate(s,p,'scheduleWithRelativeAndState');});};schedulerProto.scheduleRecursiveWithAbsolute=function(dueTime,action){return this.scheduleRecursiveWithAbsoluteAndState(action,dueTime,function(_action,self){_action(function(dt){self(_action,dt);});});};schedulerProto.scheduleRecursiveWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute({first:state,second:action},dueTime,function(s,p){return invokeRecDate(s,p,'scheduleWithAbsoluteAndState');});};Scheduler.now=defaultNow;Scheduler.normalize=function(timeSpan){if(timeSpan<0){timeSpan=0;}
return timeSpan;};return Scheduler;}());var schedulerNoBlockError='Scheduler is not allowed to block the thread';var immediateScheduler=Scheduler.immediate=(function(){function scheduleNow(state,action){return action(this,state);}
function scheduleRelative(state,dueTime,action){if(dueTime>0)throw new Error(schedulerNoBlockError);return action(this,state);}
function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action);}
return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute);}());var currentThreadScheduler=Scheduler.currentThread=(function(){var queue;function Trampoline(){queue=new PriorityQueue(4);}
Trampoline.prototype.dispose=function(){queue=null;};Trampoline.prototype.run=function(){var item;while(queue.length>0){item=queue.dequeue();if(!item.isCancelled()){while(item.dueTime-Scheduler.now()>0){}
if(!item.isCancelled()){item.invoke();}}}};function scheduleNow(state,action){return this.scheduleWithRelativeAndState(state,0,action);}
function scheduleRelative(state,dueTime,action){var dt=this.now()+Scheduler.normalize(dueTime),si=new ScheduledItem(this,state,action,dt),t;if(!queue){t=new Trampoline();try{queue.enqueue(si);t.run();}catch(e){throw e;}finally{t.dispose();}}else{queue.enqueue(si);}
return si.disposable;}
function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action);}
var currentScheduler=new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute);currentScheduler.scheduleRequired=function(){return queue===null;};currentScheduler.ensureTrampoline=function(action){if(queue===null){return this.schedule(action);}else{return action();}};return currentScheduler;}());var SchedulePeriodicRecursive=(function(){function tick(command,recurse){recurse(0,this._period);try{this._state=this._action(this._state);}catch(e){this._cancel.dispose();throw e;}}
function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler;this._state=state;this._period=period;this._action=action;}
SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable();this._cancel=d;d.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,tick.bind(this)));return d;};return SchedulePeriodicRecursive;}());Rx.VirtualTimeScheduler=(function(_super){function localNow(){return this.toDateTimeOffset(this.clock);}
function scheduleNow(state,action){return this.scheduleAbsoluteWithState(state,this.clock,action);}
function scheduleRelative(state,dueTime,action){return this.scheduleRelativeWithState(state,this.toRelative(dueTime),action);}
function scheduleAbsolute(state,dueTime,action){return this.scheduleRelativeWithState(state,this.toRelative(dueTime-this.now()),action);}
function invokeAction(scheduler,action){action();return disposableEmpty;}
inherits(VirtualTimeScheduler,_super);function VirtualTimeScheduler(initialClock,comparer){this.clock=initialClock;this.comparer=comparer;this.isEnabled=false;this.queue=new PriorityQueue(1024);_super.call(this,localNow,scheduleNow,scheduleRelative,scheduleAbsolute);}
var VirtualTimeSchedulerPrototype=VirtualTimeScheduler.prototype;VirtualTimeSchedulerPrototype.schedulePeriodicWithState=function(state,period,action){var s=new SchedulePeriodicRecursive(this,state,period,action);return s.start();};VirtualTimeSchedulerPrototype.scheduleRelativeWithState=function(state,dueTime,action){var runAt=this.add(this.clock,dueTime);return this.scheduleAbsoluteWithState(state,runAt,action);};VirtualTimeSchedulerPrototype.scheduleRelative=function(dueTime,action){return this.scheduleRelativeWithState(action,dueTime,invokeAction);};VirtualTimeSchedulerPrototype.start=function(){var next;if(!this.isEnabled){this.isEnabled=true;do{next=this.getNext();if(next!==null){if(this.comparer(next.dueTime,this.clock)>0){this.clock=next.dueTime;}
next.invoke();}else{this.isEnabled=false;}}while(this.isEnabled);}};VirtualTimeSchedulerPrototype.stop=function(){this.isEnabled=false;};VirtualTimeSchedulerPrototype.advanceTo=function(time){var next;var dueToClock=this.comparer(this.clock,time);if(this.comparer(this.clock,time)>0){throw new Error(argumentOutOfRange);}
if(dueToClock===0){return;}
if(!this.isEnabled){this.isEnabled=true;do{next=this.getNext();if(next!==null&&this.comparer(next.dueTime,time)<=0){if(this.comparer(next.dueTime,this.clock)>0){this.clock=next.dueTime;}
next.invoke();}else{this.isEnabled=false;}}while(this.isEnabled);this.clock=time;}};VirtualTimeSchedulerPrototype.advanceBy=function(time){var dt=this.add(this.clock,time);var dueToClock=this.comparer(this.clock,dt);if(dueToClock>0){throw new Error(argumentOutOfRange);}
if(dueToClock===0){return;}
return this.advanceTo(dt);};VirtualTimeSchedulerPrototype.sleep=function(time){var dt=this.add(this.clock,time);if(this.comparer(this.clock,dt)>=0){throw new Error(argumentOutOfRange);}
this.clock=dt;};VirtualTimeSchedulerPrototype.getNext=function(){var next;while(this.queue.length>0){next=this.queue.peek();if(next.isCancelled()){this.queue.dequeue();}else{return next;}}
return null;};VirtualTimeSchedulerPrototype.scheduleAbsolute=function(dueTime,action){return this.scheduleAbsoluteWithState(action,dueTime,invokeAction);};VirtualTimeSchedulerPrototype.scheduleAbsoluteWithState=function(state,dueTime,action){var self=this,run=function(scheduler,state1){self.queue.remove(si);return action(scheduler,state1);},si=new ScheduledItem(self,state,run,dueTime,self.comparer);self.queue.enqueue(si);return si.disposable;};return VirtualTimeScheduler;}(Scheduler));Rx.HistoricalScheduler=(function(_super){inherits(HistoricalScheduler,_super);function HistoricalScheduler(initialClock,comparer){var clock=initialClock==null?0:initialClock;var cmp=comparer||defaultSubComparer;_super.call(this,clock,cmp);}
var HistoricalSchedulerProto=HistoricalScheduler.prototype;HistoricalSchedulerProto.add=function(absolute,relative){return absolute+relative;};HistoricalSchedulerProto.toDateTimeOffset=function(absolute){return new Date(absolute).getTime();};HistoricalSchedulerProto.toRelative=function(timeSpan){return timeSpan;};return HistoricalScheduler;}(Rx.VirtualTimeScheduler));var scheduleMethod,clearMethod=noop;(function(){function postMessageSupported(){if(!window.postMessage||window.importScripts){return false;}
var isAsync=false,oldHandler=window.onmessage;window.onmessage=function(){isAsync=true;};window.postMessage('','*');window.onmessage=oldHandler;return isAsync;}
if(!!window.setImmediate&&typeof window.setImmediate==='function'){scheduleMethod=window.setImmediate;clearMethod=window.clearImmediate;}else if(typeof window.process==='object'&&Object.prototype.toString.call(window.process)==='[object process]'){scheduleMethod=window.process.nextTick;}else if(postMessageSupported()){var MSG_PREFIX='ms.rx.schedule'+Math.random(),tasks={},taskId=0;function onGlobalPostMessage(event){if(typeof event.data==='string'&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX){var handleId=event.data.substring(MSG_PREFIX.length),action=tasks[handleId];action();delete tasks[handleId];}}
if(window.addEventListener){window.addEventListener('message',onGlobalPostMessage,false);}else{window.attachEvent('onmessage',onGlobalPostMessage,false);}
scheduleMethod=function(action){var currentId=taskId++;tasks[currentId]=action;window.postMessage(MSG_PREFIX+currentId,'*');};}else if(!!window.MessageChannel){var channel=new window.MessageChannel(),channelTasks={},channelTaskId=0;channel.port1.onmessage=function(event){var id=event.data,action=channelTasks[id];action();delete channelTasks[id];};scheduleMethod=function(action){var id=channelTaskId++;channelTasks[id]=action;channel.port2.postMessage(id);};}else if('document'in window&&'onreadystatechange'in window.document.createElement('script')){scheduleMethod=function(action){var scriptElement=window.document.createElement('script');scriptElement.onreadystatechange=function(){action();scriptElement.onreadystatechange=null;scriptElement.parentNode.removeChild(scriptElement);scriptElement=null;};window.document.documentElement.appendChild(scriptElement);};}else{scheduleMethod=function(action){return window.setTimeout(action,0);};clearMethod=window.clearTimeout;}}());var timeoutScheduler=Scheduler.timeout=(function(){function scheduleNow(state,action){var scheduler=this,disposable=new SingleAssignmentDisposable();var id=scheduleMethod(function(){if(!disposable.isDisposed){disposable.setDisposable(action(scheduler,state));}});return new CompositeDisposable(disposable,disposableCreate(function(){clearMethod(id);}));}
function scheduleRelative(state,dueTime,action){var scheduler=this,dt=Scheduler.normalize(dueTime);if(dt===0){return scheduler.scheduleWithState(state,action);}
var disposable=new SingleAssignmentDisposable();var id=window.setTimeout(function(){if(!disposable.isDisposed){disposable.setDisposable(action(scheduler,state));}},dt);return new CompositeDisposable(disposable,disposableCreate(function(){window.clearTimeout(id);}));}
function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action);}
return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute);})();var CatchScheduler=(function(_super){function localNow(){return this._scheduler.now();}
function scheduleNow(state,action){return this._scheduler.scheduleWithState(state,this._wrap(action));}
function scheduleRelative(state,dueTime,action){return this._scheduler.scheduleWithRelativeAndState(state,dueTime,this._wrap(action));}
function scheduleAbsolute(state,dueTime,action){return this._scheduler.scheduleWithAbsoluteAndState(state,dueTime,this._wrap(action));}
inherits(CatchScheduler,_super);function CatchScheduler(scheduler,handler){this._scheduler=scheduler;this._handler=handler;this._recursiveOriginal=null;this._recursiveWrapper=null;_super.call(this,localNow,scheduleNow,scheduleRelative,scheduleAbsolute);}
CatchScheduler.prototype._clone=function(scheduler){return new CatchScheduler(scheduler,this._handler);};CatchScheduler.prototype._wrap=function(action){var parent=this;return function(self,state){try{return action(parent._getRecursiveWrapper(self),state);}catch(e){if(!parent._handler(e)){throw e;}
return disposableEmpty;}};};CatchScheduler.prototype._getRecursiveWrapper=function(scheduler){if(this._recursiveOriginal!==scheduler){this._recursiveOriginal=scheduler;var wrapper=this._clone(scheduler);wrapper._recursiveOriginal=scheduler;wrapper._recursiveWrapper=wrapper;this._recursiveWrapper=wrapper;}
return this._recursiveWrapper;};CatchScheduler.prototype.schedulePeriodicWithState=function(state,period,action){var self=this,failed=false,d=new SingleAssignmentDisposable();d.setDisposable(this._scheduler.schedulePeriodicWithState(state,period,function(state1){if(failed){return null;}
try{return action(state1);}catch(e){failed=true;if(!self._handler(e)){throw e;}
d.dispose();return null;}}));return d;};return CatchScheduler;}(Scheduler));var Notification=Rx.Notification=(function(){function Notification(kind,hasValue){this.hasValue=hasValue==null?false:hasValue;this.kind=kind;}
var NotificationPrototype=Notification.prototype;NotificationPrototype.accept=function(observerOrOnNext,onError,onCompleted){if(arguments.length===1&&typeof observerOrOnNext==='object'){return this._acceptObservable(observerOrOnNext);}
return this._accept(observerOrOnNext,onError,onCompleted);};NotificationPrototype.toObservable=function(scheduler){var notification=this;scheduler=scheduler||immediateScheduler;return new AnonymousObservable(function(observer){return scheduler.schedule(function(){notification._acceptObservable(observer);if(notification.kind==='N'){observer.onCompleted();}});});};return Notification;})();var notificationCreateOnNext=Notification.createOnNext=(function(){function _accept(onNext){return onNext(this.value);}
function _acceptObservable(observer){return observer.onNext(this.value);}
function toString(){return'OnNext('+this.value+')';}
return function(value){var notification=new Notification('N',true);notification.value=value;notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification;};}());var notificationCreateOnError=Notification.createOnError=(function(){function _accept(onNext,onError){return onError(this.exception);}
function _acceptObservable(observer){return observer.onError(this.exception);}
function toString(){return'OnError('+this.exception+')';}
return function(exception){var notification=new Notification('E');notification.exception=exception;notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification;};}());var notificationCreateOnCompleted=Notification.createOnCompleted=(function(){function _accept(onNext,onError,onCompleted){return onCompleted();}
function _acceptObservable(observer){return observer.onCompleted();}
function toString(){return'OnCompleted()';}
return function(){var notification=new Notification('C');notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification;};}());var Enumerator=Rx.Internals.Enumerator=function(moveNext,getCurrent,dispose){this.moveNext=moveNext;this.getCurrent=getCurrent;this.dispose=dispose;};var enumeratorCreate=Enumerator.create=function(moveNext,getCurrent,dispose){var done=false;dispose||(dispose=noop);return new Enumerator(function(){if(done){return false;}
var result=moveNext();if(!result){done=true;dispose();}
return result;},function(){return getCurrent();},function(){if(!done){dispose();done=true;}});};var Enumerable=Rx.Internals.Enumerable=(function(){function Enumerable(getEnumerator){this.getEnumerator=getEnumerator;}
Enumerable.prototype.concat=function(){var sources=this;return new AnonymousObservable(function(observer){var e=sources.getEnumerator(),isDisposed=false,subscription=new SerialDisposable();var cancelable=immediateScheduler.scheduleRecursive(function(self){var current,ex,hasNext=false;if(!isDisposed){try{hasNext=e.moveNext();if(hasNext){current=e.getCurrent();}else{e.dispose();}}catch(exception){ex=exception;e.dispose();}}else{return;}
if(ex){observer.onError(ex);return;}
if(!hasNext){observer.onCompleted();return;}
var d=new SingleAssignmentDisposable();subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),observer.onError.bind(observer),function(){self();}));});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true;e.dispose();}));});};Enumerable.prototype.catchException=function(){var sources=this;return new AnonymousObservable(function(observer){var e=sources.getEnumerator(),isDisposed=false,lastException;var subscription=new SerialDisposable();var cancelable=immediateScheduler.scheduleRecursive(function(self){var current,ex,hasNext;hasNext=false;if(!isDisposed){try{hasNext=e.moveNext();if(hasNext){current=e.getCurrent();}}catch(exception){ex=exception;}}else{return;}
if(ex){observer.onError(ex);return;}
if(!hasNext){if(lastException){observer.onError(lastException);}else{observer.onCompleted();}
return;}
var d=new SingleAssignmentDisposable();subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),function(exn){lastException=exn;self();},observer.onCompleted.bind(observer)));});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true;}));});};return Enumerable;}());var enumerableRepeat=Enumerable.repeat=function(value,repeatCount){if(repeatCount===undefined){repeatCount=-1;}
return new Enumerable(function(){var current,left=repeatCount;return enumeratorCreate(function(){if(left===0){return false;}
if(left>0){left--;}
current=value;return true;},function(){return current;});});};var enumerableFor=Enumerable.forEach=function(source,selector){selector||(selector=identity);return new Enumerable(function(){var current,index=-1;return enumeratorCreate(function(){if(++index<source.length){current=selector(source[index],index);return true;}
return false;},function(){return current;});});};var Observer=Rx.Observer=function(){};Observer.prototype.toNotifier=function(){var observer=this;return function(n){return n.accept(observer);};};Observer.prototype.asObserver=function(){return new AnonymousObserver(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this));};Observer.prototype.checked=function(){return new CheckedObserver(this);};var observerCreate=Observer.create=function(onNext,onError,onCompleted){onNext||(onNext=noop);onError||(onError=defaultError);onCompleted||(onCompleted=noop);return new AnonymousObserver(onNext,onError,onCompleted);};Observer.fromNotifier=function(handler){return new AnonymousObserver(function(x){return handler(notificationCreateOnNext(x));},function(exception){return handler(notificationCreateOnError(exception));},function(){return handler(notificationCreateOnCompleted());});};var AbstractObserver=Rx.Internals.AbstractObserver=(function(_super){inherits(AbstractObserver,_super);function AbstractObserver(){this.isStopped=false;_super.call(this);}
AbstractObserver.prototype.onNext=function(value){if(!this.isStopped){this.next(value);}};AbstractObserver.prototype.onError=function(error){if(!this.isStopped){this.isStopped=true;this.error(error);}};AbstractObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed();}};AbstractObserver.prototype.dispose=function(){this.isStopped=true;};AbstractObserver.prototype.fail=function(){if(!this.isStopped){this.isStopped=true;this.error(true);return true;}
return false;};return AbstractObserver;}(Observer));var AnonymousObserver=Rx.AnonymousObserver=(function(_super){inherits(AnonymousObserver,_super);function AnonymousObserver(onNext,onError,onCompleted){_super.call(this);this._onNext=onNext;this._onError=onError;this._onCompleted=onCompleted;}
AnonymousObserver.prototype.next=function(value){this._onNext(value);};AnonymousObserver.prototype.error=function(exception){this._onError(exception);};AnonymousObserver.prototype.completed=function(){this._onCompleted();};return AnonymousObserver;}(AbstractObserver));var CheckedObserver=(function(_super){inherits(CheckedObserver,_super);function CheckedObserver(observer){_super.call(this);this._observer=observer;this._state=0;}
var CheckedObserverPrototype=CheckedObserver.prototype;CheckedObserverPrototype.onNext=function(value){this.checkAccess();try{this._observer.onNext(value);}catch(e){throw e;}finally{this._state=0;}};CheckedObserverPrototype.onError=function(err){this.checkAccess();try{this._observer.onError(err);}catch(e){throw e;}finally{this._state=2;}};CheckedObserverPrototype.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted();}catch(e){throw e;}finally{this._state=2;}};CheckedObserverPrototype.checkAccess=function(){if(this._state===1){throw new Error('Re-entrancy detected');}
if(this._state===2){throw new Error('Observer completed');}
if(this._state===0){this._state=1;}};return CheckedObserver;}(Observer));var ScheduledObserver=Rx.Internals.ScheduledObserver=(function(_super){inherits(ScheduledObserver,_super);function ScheduledObserver(scheduler,observer){_super.call(this);this.scheduler=scheduler;this.observer=observer;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new SerialDisposable();}
ScheduledObserver.prototype.next=function(value){var self=this;this.queue.push(function(){self.observer.onNext(value);});};ScheduledObserver.prototype.error=function(exception){var self=this;this.queue.push(function(){self.observer.onError(exception);});};ScheduledObserver.prototype.completed=function(){var self=this;this.queue.push(function(){self.observer.onCompleted();});};ScheduledObserver.prototype.ensureActive=function(){var isOwner=false,parent=this;if(!this.hasFaulted&&this.queue.length>0){isOwner=!this.isAcquired;this.isAcquired=true;}
if(isOwner){this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(self){var work;if(parent.queue.length>0){work=parent.queue.shift();}else{parent.isAcquired=false;return;}
try{work();}catch(ex){parent.queue=[];parent.hasFaulted=true;throw ex;}
self();}));}};ScheduledObserver.prototype.dispose=function(){_super.prototype.dispose.call(this);this.disposable.dispose();};return ScheduledObserver;}(AbstractObserver));var ObserveOnObserver=(function(_super){inherits(ObserveOnObserver,_super);function ObserveOnObserver(){_super.apply(this,arguments);}
ObserveOnObserver.prototype.next=function(value){_super.prototype.next.call(this,value);this.ensureActive();};ObserveOnObserver.prototype.error=function(e){_super.prototype.error.call(this,e);this.ensureActive();};ObserveOnObserver.prototype.completed=function(){_super.prototype.completed.call(this);this.ensureActive();};return ObserveOnObserver;})(ScheduledObserver);var observableProto;var Observable=Rx.Observable=(function(){function Observable(subscribe){this._subscribe=subscribe;}
observableProto=Observable.prototype;observableProto.finalValue=function(){var source=this;return new AnonymousObservable(function(observer){var hasValue=false,value;return source.subscribe(function(x){hasValue=true;value=x;},observer.onError.bind(observer),function(){if(!hasValue){observer.onError(new Error(sequenceContainsNoElements));}else{observer.onNext(value);observer.onCompleted();}});});};observableProto.subscribe=observableProto.forEach=function(observerOrOnNext,onError,onCompleted){var subscriber;if(typeof observerOrOnNext==='object'){subscriber=observerOrOnNext;}else{subscriber=observerCreate(observerOrOnNext,onError,onCompleted);}
return this._subscribe(subscriber);};observableProto.toArray=function(){function accumulator(list,i){var newList=list.slice(0);newList.push(i);return newList;}
return this.scan([],accumulator).startWith([]).finalValue();};return Observable;})();Observable.start=function(func,scheduler,context){return observableToAsync(func,scheduler)();};var observableToAsync=Observable.toAsync=function(func,scheduler,context){scheduler||(scheduler=timeoutScheduler);return function(){var args=slice.call(arguments,0),subject=new AsyncSubject();scheduler.schedule(function(){var result;try{result=func.apply(context,args);}catch(e){subject.onError(e);return;}
subject.onNext(result);subject.onCompleted();});return subject.asObservable();};};observableProto.observeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(new ObserveOnObserver(scheduler,observer));});};observableProto.subscribeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable(),d=new SerialDisposable();d.setDisposable(m);m.setDisposable(scheduler.schedule(function(){d.setDisposable(new ScheduledDisposable(scheduler,source.subscribe(observer)));}));return d;});};Observable.create=function(subscribe){return new AnonymousObservable(function(o){return disposableCreate(subscribe(o));});};Observable.createWithDisposable=function(subscribe){return new AnonymousObservable(subscribe);};var observableDefer=Observable.defer=function(observableFactory){return new AnonymousObservable(function(observer){var result;try{result=observableFactory();}catch(e){return observableThrow(e).subscribe(observer);}
return result.subscribe(observer);});};var observableEmpty=Observable.empty=function(scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onCompleted();});});};var observableFromArray=Observable.fromArray=function(array,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){var count=0;return scheduler.scheduleRecursive(function(self){if(count<array.length){observer.onNext(array[count++]);self();}else{observer.onCompleted();}});});};Observable.generate=function(initialState,condition,iterate,resultSelector,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){var first=true,state=initialState;return scheduler.scheduleRecursive(function(self){var hasResult,result;try{if(first){first=false;}else{state=iterate(state);}
hasResult=condition(state);if(hasResult){result=resultSelector(state);}}catch(exception){observer.onError(exception);return;}
if(hasResult){observer.onNext(result);self();}else{observer.onCompleted();}});});};var observableNever=Observable.never=function(){return new AnonymousObservable(function(){return disposableEmpty;});};Observable.range=function(start,count,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){return scheduler.scheduleRecursiveWithState(0,function(i,self){if(i<count){observer.onNext(start+i);self(i+1);}else{observer.onCompleted();}});});};Observable.repeat=function(value,repeatCount,scheduler){scheduler||(scheduler=currentThreadScheduler);if(repeatCount==null){repeatCount=-1;}
return observableReturn(value,scheduler).repeat(repeatCount);};var observableReturn=Observable['return']=Observable.returnValue=function(value,scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onNext(value);observer.onCompleted();});});};var observableThrow=Observable['throw']=Observable.throwException=function(exception,scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onError(exception);});});};Observable.using=function(resourceFactory,observableFactory){return new AnonymousObservable(function(observer){var disposable=disposableEmpty,resource,source;try{resource=resourceFactory();if(resource){disposable=resource;}
source=observableFactory(resource);}catch(exception){return new CompositeDisposable(observableThrow(exception).subscribe(observer),disposable);}
return new CompositeDisposable(source.subscribe(observer),disposable);});};observableProto.amb=function(rightSource){var leftSource=this;return new AnonymousObservable(function(observer){var choice,leftChoice='L',rightChoice='R',leftSubscription=new SingleAssignmentDisposable(),rightSubscription=new SingleAssignmentDisposable();function choiceL(){if(!choice){choice=leftChoice;rightSubscription.dispose();}}
function choiceR(){if(!choice){choice=rightChoice;leftSubscription.dispose();}}
leftSubscription.setDisposable(leftSource.subscribe(function(left){choiceL();if(choice===leftChoice){observer.onNext(left);}},function(err){choiceL();if(choice===leftChoice){observer.onError(err);}},function(){choiceL();if(choice===leftChoice){observer.onCompleted();}}));rightSubscription.setDisposable(rightSource.subscribe(function(right){choiceR();if(choice===rightChoice){observer.onNext(right);}},function(err){choiceR();if(choice===rightChoice){observer.onError(err);}},function(){choiceR();if(choice===rightChoice){observer.onCompleted();}}));return new CompositeDisposable(leftSubscription,rightSubscription);});};Observable.amb=function(){var acc=observableNever(),items=argsOrArray(arguments,0);function func(previous,current){return previous.amb(current);}
for(var i=0,len=items.length;i<len;i++){acc=func(acc,items[i]);}
return acc;};function observableCatchHandler(source,handler){return new AnonymousObservable(function(observer){var d1=new SingleAssignmentDisposable(),subscription=new SerialDisposable();subscription.setDisposable(d1);d1.setDisposable(source.subscribe(observer.onNext.bind(observer),function(exception){var d,result;try{result=handler(exception);}catch(ex){observer.onError(ex);return;}
d=new SingleAssignmentDisposable();subscription.setDisposable(d);d.setDisposable(result.subscribe(observer));},observer.onCompleted.bind(observer)));return subscription;});}
observableProto.catchException=function(handlerOrSecond){if(typeof handlerOrSecond==='function'){return observableCatchHandler(this,handlerOrSecond);}
return observableCatch([this,handlerOrSecond]);};var observableCatch=Observable.catchException=function(){var items=argsOrArray(arguments,0);return enumerableFor(items).catchException();};observableProto.combineLatest=function(){var args=slice.call(arguments);if(Array.isArray(args[0])){args[0].unshift(this);}else{args.unshift(this);}
return combineLatest.apply(this,args);};var combineLatest=Observable.combineLatest=function(){var args=slice.call(arguments),resultSelector=args.pop();if(Array.isArray(args[0])){args=args[0];}
return new AnonymousObservable(function(observer){var falseFactory=function(){return false;},n=args.length,hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,isDone=arrayInitialize(n,falseFactory),values=new Array(n);function next(i){var res;hasValue[i]=true;if(hasValueAll||(hasValueAll=hasValue.every(function(x){return x;}))){try{res=resultSelector.apply(null,values);}catch(ex){observer.onError(ex);return;}
observer.onNext(res);}else if(isDone.filter(function(x,j){return j!==i;}).every(function(x){return x;})){observer.onCompleted();}}
function done(i){isDone[i]=true;if(isDone.every(function(x){return x;})){observer.onCompleted();}}
var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable();subscriptions[i].setDisposable(args[i].subscribe(function(x){values[i]=x;next(i);},observer.onError.bind(observer),function(){done(i);}));}(idx));}
return new CompositeDisposable(subscriptions);});};observableProto.concat=function(){var items=slice.call(arguments,0);items.unshift(this);return observableConcat.apply(this,items);};var observableConcat=Observable.concat=function(){var sources=argsOrArray(arguments,0);return enumerableFor(sources).concat();};observableProto.concatObservable=observableProto.concatAll=function(){return this.merge(1);};observableProto.merge=function(maxConcurrentOrOther){if(typeof maxConcurrentOrOther!=='number'){return observableMerge(this,maxConcurrentOrOther);}
var sources=this;return new AnonymousObservable(function(observer){var activeCount=0,group=new CompositeDisposable(),isStopped=false,q=[],subscribe=function(xs){var subscription=new SingleAssignmentDisposable();group.add(subscription);subscription.setDisposable(xs.subscribe(observer.onNext.bind(observer),observer.onError.bind(observer),function(){var s;group.remove(subscription);if(q.length>0){s=q.shift();subscribe(s);}else{activeCount--;if(isStopped&&activeCount===0){observer.onCompleted();}}}));};group.add(sources.subscribe(function(innerSource){if(activeCount<maxConcurrentOrOther){activeCount++;subscribe(innerSource);}else{q.push(innerSource);}},observer.onError.bind(observer),function(){isStopped=true;if(activeCount===0){observer.onCompleted();}}));return group;});};var observableMerge=Observable.merge=function(){var scheduler,sources;if(!arguments[0]){scheduler=immediateScheduler;sources=slice.call(arguments,1);}else if(arguments[0].now){scheduler=arguments[0];sources=slice.call(arguments,1);}else{scheduler=immediateScheduler;sources=slice.call(arguments,0);}
if(Array.isArray(sources[0])){sources=sources[0];}
return observableFromArray(sources,scheduler).mergeObservable();};observableProto.mergeObservable=observableProto.mergeAll=function(){var sources=this;return new AnonymousObservable(function(observer){var group=new CompositeDisposable(),isStopped=false,m=new SingleAssignmentDisposable();group.add(m);m.setDisposable(sources.subscribe(function(innerSource){var innerSubscription=new SingleAssignmentDisposable();group.add(innerSubscription);innerSubscription.setDisposable(innerSource.subscribe(function(x){observer.onNext(x);},observer.onError.bind(observer),function(){group.remove(innerSubscription);if(isStopped&&group.length===1){observer.onCompleted();}}));},observer.onError.bind(observer),function(){isStopped=true;if(group.length===1){observer.onCompleted();}}));return group;});};observableProto.onErrorResumeNext=function(second){if(!second){throw new Error('Second observable is required');}
return onErrorResumeNext([this,second]);};var onErrorResumeNext=Observable.onErrorResumeNext=function(){var sources=argsOrArray(arguments,0);return new AnonymousObservable(function(observer){var pos=0,subscription=new SerialDisposable(),cancelable=immediateScheduler.scheduleRecursive(function(self){var current,d;if(pos<sources.length){current=sources[pos++];d=new SingleAssignmentDisposable();subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),function(){self();},function(){self();}));}else{observer.onCompleted();}});return new CompositeDisposable(subscription,cancelable);});};observableProto.skipUntil=function(other){var source=this;return new AnonymousObservable(function(observer){var isOpen=false;var disposables=new CompositeDisposable(source.subscribe(function(left){if(isOpen){observer.onNext(left);}},observer.onError.bind(observer),function(){if(isOpen){observer.onCompleted();}}));var rightSubscription=new SingleAssignmentDisposable();disposables.add(rightSubscription);rightSubscription.setDisposable(other.subscribe(function(){isOpen=true;rightSubscription.dispose();},observer.onError.bind(observer),function(){rightSubscription.dispose();}));return disposables;});};observableProto.switchLatest=function(){var sources=this;return new AnonymousObservable(function(observer){var hasLatest=false,innerSubscription=new SerialDisposable(),isStopped=false,latest=0,subscription=sources.subscribe(function(innerSource){var d=new SingleAssignmentDisposable(),id=++latest;hasLatest=true;innerSubscription.setDisposable(d);d.setDisposable(innerSource.subscribe(function(x){if(latest===id){observer.onNext(x);}},function(e){if(latest===id){observer.onError(e);}},function(){if(latest===id){hasLatest=false;if(isStopped){observer.onCompleted();}}}));},observer.onError.bind(observer),function(){isStopped=true;if(!hasLatest){observer.onCompleted();}});return new CompositeDisposable(subscription,innerSubscription);});};observableProto.takeUntil=function(other){var source=this;return new AnonymousObservable(function(observer){return new CompositeDisposable(source.subscribe(observer),other.subscribe(observer.onCompleted.bind(observer),observer.onError.bind(observer),noop));});};function zipArray(second,resultSelector){var first=this;return new AnonymousObservable(function(observer){var index=0,len=second.length;return first.subscribe(function(left){if(index<len){var right=second[index++],result;try{result=resultSelector(left,right);}catch(e){observer.onError(e);return;}
observer.onNext(result);}else{observer.onCompleted();}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});}
observableProto.zip=function(){if(Array.isArray(arguments[0])){return zipArray.apply(this,arguments);}
var parent=this,sources=slice.call(arguments),resultSelector=sources.pop();sources.unshift(parent);return new AnonymousObservable(function(observer){var n=sources.length,queues=arrayInitialize(n,function(){return[];}),isDone=arrayInitialize(n,function(){return false;});var next=function(i){var res,queuedValues;if(queues.every(function(x){return x.length>0;})){try{queuedValues=queues.map(function(x){return x.shift();});res=resultSelector.apply(parent,queuedValues);}catch(ex){observer.onError(ex);return;}
observer.onNext(res);}else if(isDone.filter(function(x,j){return j!==i;}).every(identity)){observer.onCompleted();}};function done(i){isDone[i]=true;if(isDone.every(function(x){return x;})){observer.onCompleted();}}
var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable();subscriptions[i].setDisposable(sources[i].subscribe(function(x){queues[i].push(x);next(i);},observer.onError.bind(observer),function(){done(i);}));})(idx);}
return new CompositeDisposable(subscriptions);});};Observable.zip=function(){var args=slice.call(arguments,0),first=args.shift();return first.zip.apply(first,args);};Observable.zipArray=function(){var sources=slice.call(arguments);return new AnonymousObservable(function(observer){var n=sources.length,queues=arrayInitialize(n,function(){return[];}),isDone=arrayInitialize(n,function(){return false;});function next(i){if(queues.every(function(x){return x.length>0;})){var res=queues.map(function(x){return x.shift();});observer.onNext(res);}else if(isDone.filter(function(x,j){return j!==i;}).every(identity)){observer.onCompleted();return;}};function done(i){isDone[i]=true;if(isDone.every(identity)){observer.onCompleted();return;}}
var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable();subscriptions[i].setDisposable(sources[i].subscribe(function(x){queues[i].push(x);next(i);},observer.onError.bind(observer),function(){done(i);}));})(idx);}
var compositeDisposable=new CompositeDisposable(subscriptions);compositeDisposable.add(disposableCreate(function(){for(var qIdx=0,qLen=queues.length;qIdx<qLen;qIdx++){queues[qIdx]=[];}}));return compositeDisposable;});};observableProto.asObservable=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(observer);});};observableProto.bufferWithCount=function(count,skip){if(skip===undefined){skip=count;}
return this.windowWithCount(count,skip).selectMany(function(x){return x.toArray();}).where(function(x){return x.length>0;});};observableProto.dematerialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(x){return x.accept(observer);},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.distinctUntilChanged=function(keySelector,comparer){var source=this;keySelector||(keySelector=identity);comparer||(comparer=defaultComparer);return new AnonymousObservable(function(observer){var hasCurrentKey=false,currentKey;return source.subscribe(function(value){var comparerEquals=false,key;try{key=keySelector(value);}catch(exception){observer.onError(exception);return;}
if(hasCurrentKey){try{comparerEquals=comparer(currentKey,key);}catch(exception){observer.onError(exception);return;}}
if(!hasCurrentKey||!comparerEquals){hasCurrentKey=true;currentKey=key;observer.onNext(value);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.doAction=function(observerOrOnNext,onError,onCompleted){var source=this,onNextFunc;if(typeof observerOrOnNext==='function'){onNextFunc=observerOrOnNext;}else{onNextFunc=observerOrOnNext.onNext.bind(observerOrOnNext);onError=observerOrOnNext.onError.bind(observerOrOnNext);onCompleted=observerOrOnNext.onCompleted.bind(observerOrOnNext);}
return new AnonymousObservable(function(observer){return source.subscribe(function(x){try{onNextFunc(x);}catch(e){observer.onError(e);}
observer.onNext(x);},function(exception){if(!onError){observer.onError(exception);}else{try{onError(exception);}catch(e){observer.onError(e);}
observer.onError(exception);}},function(){if(!onCompleted){observer.onCompleted();}else{try{onCompleted();}catch(e){observer.onError(e);}
observer.onCompleted();}});});};observableProto.finallyAction=function(action){var source=this;return new AnonymousObservable(function(observer){var subscription=source.subscribe(observer);return disposableCreate(function(){try{subscription.dispose();}catch(e){throw e;}finally{action();}});});};observableProto.ignoreElements=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(noop,observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.materialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(value){observer.onNext(notificationCreateOnNext(value));},function(exception){observer.onNext(notificationCreateOnError(exception));observer.onCompleted();},function(){observer.onNext(notificationCreateOnCompleted());observer.onCompleted();});});};observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat();};observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchException();};observableProto.scan=function(){var seed,hasSeed=false,accumulator;if(arguments.length===2){seed=arguments[0];accumulator=arguments[1];hasSeed=true;}else{accumulator=arguments[0];}
var source=this;return observableDefer(function(){var hasAccumulation=false,accumulation;return source.select(function(x){if(hasAccumulation){accumulation=accumulator(accumulation,x);}else{accumulation=hasSeed?accumulator(seed,x):x;hasAccumulation=true;}
return accumulation;});});};observableProto.skipLast=function(count){var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){q.push(x);if(q.length>count){observer.onNext(q.shift());}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.startWith=function(){var values,scheduler,start=0;if(!!arguments.length&&'now'in Object(arguments[0])){scheduler=arguments[0];start=1;}else{scheduler=immediateScheduler;}
values=slice.call(arguments,start);return enumerableFor([observableFromArray(values,scheduler),this]).concat();};observableProto.takeLast=function(count,scheduler){return this.takeLastBuffer(count).selectMany(function(xs){return observableFromArray(xs,scheduler);});};observableProto.takeLastBuffer=function(count){var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){q.push(x);if(q.length>count){q.shift();}},observer.onError.bind(observer),function(){observer.onNext(q);observer.onCompleted();});});};observableProto.windowWithCount=function(count,skip){var source=this;if(count<=0){throw new Error(argumentOutOfRange);}
if(skip==null){skip=count;}
if(skip<=0){throw new Error(argumentOutOfRange);}
return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable(),refCountDisposable=new RefCountDisposable(m),n=0,q=[],createWindow=function(){var s=new Subject();q.push(s);observer.onNext(addRef(s,refCountDisposable));};createWindow();m.setDisposable(source.subscribe(function(x){var s;for(var i=0,len=q.length;i<len;i++){q[i].onNext(x);}
var c=n-count+1;if(c>=0&&c%skip===0){s=q.shift();s.onCompleted();}
n++;if(n%skip===0){createWindow();}},function(exception){while(q.length>0){q.shift().onError(exception);}
observer.onError(exception);},function(){while(q.length>0){q.shift().onCompleted();}
observer.onCompleted();}));return refCountDisposable;});};observableProto.defaultIfEmpty=function(defaultValue){var source=this;if(defaultValue===undefined){defaultValue=null;}
return new AnonymousObservable(function(observer){var found=false;return source.subscribe(function(x){found=true;observer.onNext(x);},observer.onError.bind(observer),function(){if(!found){observer.onNext(defaultValue);}
observer.onCompleted();});});};observableProto.distinct=function(keySelector,keySerializer){var source=this;keySelector||(keySelector=identity);keySerializer||(keySerializer=defaultKeySerializer);return new AnonymousObservable(function(observer){var hashSet={};return source.subscribe(function(x){var key,serializedKey,otherKey,hasMatch=false;try{key=keySelector(x);serializedKey=keySerializer(key);}catch(exception){observer.onError(exception);return;}
for(otherKey in hashSet){if(serializedKey===otherKey){hasMatch=true;break;}}
if(!hasMatch){hashSet[serializedKey]=null;observer.onNext(x);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.groupBy=function(keySelector,elementSelector,keySerializer){return this.groupByUntil(keySelector,elementSelector,function(){return observableNever();},keySerializer);};observableProto.groupByUntil=function(keySelector,elementSelector,durationSelector,keySerializer){var source=this;elementSelector||(elementSelector=identity);keySerializer||(keySerializer=defaultKeySerializer);return new AnonymousObservable(function(observer){var map={},groupDisposable=new CompositeDisposable(),refCountDisposable=new RefCountDisposable(groupDisposable);groupDisposable.add(source.subscribe(function(x){var duration,durationGroup,element,fireNewMapEntry,group,key,serializedKey,md,writer,w;try{key=keySelector(x);serializedKey=keySerializer(key);}catch(e){for(w in map){map[w].onError(e);}
observer.onError(e);return;}
fireNewMapEntry=false;try{writer=map[serializedKey];if(!writer){writer=new Subject();map[serializedKey]=writer;fireNewMapEntry=true;}}catch(e){for(w in map){map[w].onError(e);}
observer.onError(e);return;}
if(fireNewMapEntry){group=new GroupedObservable(key,writer,refCountDisposable);durationGroup=new GroupedObservable(key,writer);try{duration=durationSelector(durationGroup);}catch(e){for(w in map){map[w].onError(e);}
observer.onError(e);return;}
observer.onNext(group);md=new SingleAssignmentDisposable();groupDisposable.add(md);var expire=function(){if(serializedKey in map){delete map[serializedKey];writer.onCompleted();}
groupDisposable.remove(md);};md.setDisposable(duration.take(1).subscribe(noop,function(exn){for(w in map){map[w].onError(exn);}
observer.onError(exn);},function(){expire();}));}
try{element=elementSelector(x);}catch(e){for(w in map){map[w].onError(e);}
observer.onError(e);return;}
writer.onNext(element);},function(ex){for(var w in map){map[w].onError(ex);}
observer.onError(ex);},function(){for(var w in map){map[w].onCompleted();}
observer.onCompleted();}));return refCountDisposable;});};observableProto.select=function(selector,thisArg){var parent=this;return new AnonymousObservable(function(observer){var count=0;return parent.subscribe(function(value){var result;try{result=selector.call(thisArg,value,count++,parent);}catch(exception){observer.onError(exception);return;}
observer.onNext(result);},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.map=observableProto.select;function selectMany(selector){return this.select(selector).mergeObservable();}
observableProto.selectMany=observableProto.flatMap=function(selector,resultSelector){if(resultSelector){return this.selectMany(function(x){return selector(x).select(function(y){return resultSelector(x,y);});});}
if(typeof selector==='function'){return selectMany.call(this,selector);}
return selectMany.call(this,function(){return selector;});};observableProto.skip=function(count){if(count<0){throw new Error(argumentOutOfRange);}
var observable=this;return new AnonymousObservable(function(observer){var remaining=count;return observable.subscribe(function(x){if(remaining<=0){observer.onNext(x);}else{remaining--;}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.skipWhile=function(predicate){var source=this;return new AnonymousObservable(function(observer){var i=0,running=false;return source.subscribe(function(x){if(!running){try{running=!predicate(x,i++);}catch(e){observer.onError(e);return;}}
if(running){observer.onNext(x);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.take=function(count,scheduler){if(count<0){throw new Error(argumentOutOfRange);}
if(count===0){return observableEmpty(scheduler);}
var observable=this;return new AnonymousObservable(function(observer){var remaining=count;return observable.subscribe(function(x){if(remaining>0){remaining--;observer.onNext(x);if(remaining===0){observer.onCompleted();}}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.takeWhile=function(predicate){var observable=this;return new AnonymousObservable(function(observer){var i=0,running=true;return observable.subscribe(function(x){if(running){try{running=predicate(x,i++);}catch(e){observer.onError(e);return;}
if(running){observer.onNext(x);}else{observer.onCompleted();}}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.where=function(predicate,thisArg){var parent=this;return new AnonymousObservable(function(observer){var count=0;return parent.subscribe(function(value){var shouldRun;try{shouldRun=predicate.call(thisArg,value,count++,parent);}catch(exception){observer.onError(exception);return;}
if(shouldRun){observer.onNext(value);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));});};observableProto.filter=observableProto.where;var AnonymousObservable=Rx.Internals.AnonymousObservable=(function(_super){inherits(AnonymousObservable,_super);function AnonymousObservable(subscribe){if(!(this instanceof AnonymousObservable)){return new AnonymousObservable(subscribe);}
function s(observer){var autoDetachObserver=new AutoDetachObserver(observer);if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.schedule(function(){try{autoDetachObserver.disposable(subscribe(autoDetachObserver));}catch(e){if(!autoDetachObserver.fail(e)){throw e;}}});}else{try{autoDetachObserver.disposable(subscribe(autoDetachObserver));}catch(e){if(!autoDetachObserver.fail(e)){throw e;}}}
return autoDetachObserver;}
_super.call(this,s);}
return AnonymousObservable;}(Observable));var AutoDetachObserver=(function(_super){inherits(AutoDetachObserver,_super);function AutoDetachObserver(observer){_super.call(this);this.observer=observer;this.m=new SingleAssignmentDisposable();}
var AutoDetachObserverPrototype=AutoDetachObserver.prototype;AutoDetachObserverPrototype.next=function(value){var noError=false;try{this.observer.onNext(value);noError=true;}catch(e){throw e;}finally{if(!noError){this.dispose();}}};AutoDetachObserverPrototype.error=function(exn){try{this.observer.onError(exn);}catch(e){throw e;}finally{this.dispose();}};AutoDetachObserverPrototype.completed=function(){try{this.observer.onCompleted();}catch(e){throw e;}finally{this.dispose();}};AutoDetachObserverPrototype.disposable=function(value){return this.m.disposable(value);};AutoDetachObserverPrototype.dispose=function(){_super.prototype.dispose.call(this);this.m.dispose();};return AutoDetachObserver;}(AbstractObserver));var GroupedObservable=(function(_super){inherits(GroupedObservable,_super);function subscribe(observer){return this.underlyingObservable.subscribe(observer);}
function GroupedObservable(key,underlyingObservable,mergedDisposable){_super.call(this,subscribe);this.key=key;this.underlyingObservable=!mergedDisposable?underlyingObservable:new AnonymousObservable(function(observer){return new CompositeDisposable(mergedDisposable.getDisposable(),underlyingObservable.subscribe(observer));});}
return GroupedObservable;}(Observable));var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer;};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null;}};var Subject=Rx.Subject=(function(_super){function subscribe(observer){checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer);}
if(this.exception){observer.onError(this.exception);return disposableEmpty;}
observer.onCompleted();return disposableEmpty;}
inherits(Subject,_super);function Subject(){_super.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.observers=[];}
addProperties(Subject.prototype,Observer,{hasObservers:function(){return this.observers.length>0;},onCompleted:function(){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;for(var i=0,len=os.length;i<len;i++){os[i].onCompleted();}
this.observers=[];}},onError:function(exception){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=exception;for(var i=0,len=os.length;i<len;i++){os[i].onError(exception);}
this.observers=[];}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);for(var i=0,len=os.length;i<len;i++){os[i].onNext(value);}}},dispose:function(){this.isDisposed=true;this.observers=null;}});Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable);};return Subject;}(Observable));var AsyncSubject=Rx.AsyncSubject=(function(_super){function subscribe(observer){checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer);}
var ex=this.exception;var hv=this.hasValue;var v=this.value;if(ex){observer.onError(ex);}else if(hv){observer.onNext(v);observer.onCompleted();}else{observer.onCompleted();}
return disposableEmpty;}
inherits(AsyncSubject,_super);function AsyncSubject(){_super.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.value=null,this.hasValue=false,this.observers=[],this.exception=null;}
addProperties(AsyncSubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0;},onCompleted:function(){var o,i,len;checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;var v=this.value;var hv=this.hasValue;if(hv){for(i=0,len=os.length;i<len;i++){o=os[i];o.onNext(v);o.onCompleted();}}else{for(i=0,len=os.length;i<len;i++){os[i].onCompleted();}}
this.observers=[];}},onError:function(exception){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=exception;for(var i=0,len=os.length;i<len;i++){os[i].onError(exception);}
this.observers=[];}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){this.value=value;this.hasValue=true;}},dispose:function(){this.isDisposed=true;this.observers=null;this.exception=null;this.value=null;}});return AsyncSubject;}(Observable));var AnonymousSubject=(function(_super){inherits(AnonymousSubject,_super);function subscribe(observer){return this.observable.subscribe(observer);}
function AnonymousSubject(observer,observable){_super.call(this,subscribe);this.observer=observer;this.observable=observable;}
addProperties(AnonymousSubject.prototype,Observer,{onCompleted:function(){this.observer.onCompleted();},onError:function(exception){this.observer.onError(exception);},onNext:function(value){this.observer.onNext(value);}});return AnonymousSubject;}(Observable));if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){window.Rx=Rx;return define(function(){return Rx;});}else if(freeExports){if(typeof module=='object'&&module&&module.exports==freeExports){module.exports=Rx;}else{freeExports=Rx;}}else{window.Rx=Rx;}}(this));
(function(root,factory){var freeExports=typeof exports=='object'&&exports,freeModule=typeof module=='object'&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal;}
if(typeof define==='function'&&define.amd){define(['rx','exports'],function(Rx,exports){root.Rx=factory(root,exports,Rx);return root.Rx;});}else if(typeof module==='object'&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require('./rx'));}else{root.Rx=factory(root,{},root.Rx);}}(this,function(global,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,AnonymousObservable=Rx.Internals.AnonymousObservable,Subject=Rx.Subject,AsyncSubject=Rx.AsyncSubject,Observer=Rx.Observer,ScheduledObserver=Rx.Internals.ScheduledObserver,disposableCreate=Rx.Disposable.create,disposableEmpty=Rx.Disposable.empty,CompositeDisposable=Rx.CompositeDisposable,currentThreadScheduler=Rx.Scheduler.currentThread,inherits=Rx.Internals.inherits,addProperties=Rx.Internals.addProperties;var objectDisposed='Object has been disposed';function checkDisposed(){if(this.isDisposed){throw new Error(objectDisposed);}}
observableProto.multicast=function(subjectOrSubjectSelector,selector){var source=this;return typeof subjectOrSubjectSelector==='function'?new AnonymousObservable(function(observer){var connectable=source.multicast(subjectOrSubjectSelector());return new CompositeDisposable(selector(connectable).subscribe(observer),connectable.connect());}):new ConnectableObservable(source,subjectOrSubjectSelector);};observableProto.publish=function(selector){return!selector?this.multicast(new Subject()):this.multicast(function(){return new Subject();},selector);};observableProto.publishLast=function(selector){return!selector?this.multicast(new AsyncSubject()):this.multicast(function(){return new AsyncSubject();},selector);};observableProto.publishValue=function(initialValueOrSelector,initialValue){return arguments.length===2?this.multicast(function(){return new BehaviorSubject(initialValue);},initialValueOrSelector):this.multicast(new BehaviorSubject(initialValueOrSelector));};observableProto.replay=function(selector,bufferSize,window,scheduler){return!selector?this.multicast(new ReplaySubject(bufferSize,window,scheduler)):this.multicast(function(){return new ReplaySubject(bufferSize,window,scheduler);},selector);};var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer;};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null;}};var BehaviorSubject=Rx.BehaviorSubject=(function(_super){function subscribe(observer){var ex;checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);observer.onNext(this.value);return new InnerSubscription(this,observer);}
ex=this.exception;if(ex){observer.onError(ex);}else{observer.onCompleted();}
return disposableEmpty;}
inherits(BehaviorSubject,_super);function BehaviorSubject(value){_super.call(this,subscribe);this.value=value,this.observers=[],this.isDisposed=false,this.isStopped=false,this.exception=null;}
addProperties(BehaviorSubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0;},onCompleted:function(){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;for(var i=0,len=os.length;i<len;i++){os[i].onCompleted();}
this.observers=[];}},onError:function(error){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=error;for(var i=0,len=os.length;i<len;i++){os[i].onError(error);}
this.observers=[];}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){this.value=value;var os=this.observers.slice(0);for(var i=0,len=os.length;i<len;i++){os[i].onNext(value);}}},dispose:function(){this.isDisposed=true;this.observers=null;this.value=null;this.exception=null;}});return BehaviorSubject;}(Observable));var ReplaySubject=Rx.ReplaySubject=(function(_super){var RemovableDisposable=function(subject,observer){this.subject=subject;this.observer=observer;};RemovableDisposable.prototype.dispose=function(){this.observer.dispose();if(!this.subject.isDisposed){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);}};function subscribe(observer){var so=new ScheduledObserver(this.scheduler,observer),subscription=new RemovableDisposable(this,so);checkDisposed.call(this);this._trim(this.scheduler.now());this.observers.push(so);var n=this.q.length;for(var i=0,len=this.q.length;i<len;i++){so.onNext(this.q[i].value);}
if(this.hasError){n++;so.onError(this.error);}else if(this.isStopped){n++;so.onCompleted();}
so.ensureActive(n);return subscription;}
inherits(ReplaySubject,_super);function ReplaySubject(bufferSize,window,scheduler){this.bufferSize=bufferSize==null?Number.MAX_VALUE:bufferSize;this.window=window==null?Number.MAX_VALUE:window;this.scheduler=scheduler||currentThreadScheduler;this.q=[];this.observers=[];this.isStopped=false;this.isDisposed=false;this.hasError=false;this.error=null;_super.call(this,subscribe);}
addProperties(ReplaySubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0;},_trim:function(now){while(this.q.length>this.bufferSize){this.q.shift();}
while(this.q.length>0&&(now-this.q[0].interval)>this.window){this.q.shift();}},onNext:function(value){var observer;checkDisposed.call(this);if(!this.isStopped){var now=this.scheduler.now();this.q.push({interval:now,value:value});this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onNext(value);observer.ensureActive();}}},onError:function(error){var observer;checkDisposed.call(this);if(!this.isStopped){this.isStopped=true;this.error=error;this.hasError=true;var now=this.scheduler.now();this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onError(error);observer.ensureActive();}
this.observers=[];}},onCompleted:function(){var observer;checkDisposed.call(this);if(!this.isStopped){this.isStopped=true;var now=this.scheduler.now();this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onCompleted();observer.ensureActive();}
this.observers=[];}},dispose:function(){this.isDisposed=true;this.observers=null;}});return ReplaySubject;}(Observable));var ConnectableObservable=(function(_super){inherits(ConnectableObservable,_super);function ConnectableObservable(source,subject){var state={subject:subject,source:source.asObservable(),hasSubscription:false,subscription:null};this.connect=function(){if(!state.hasSubscription){state.hasSubscription=true;state.subscription=new CompositeDisposable(state.source.subscribe(state.subject),disposableCreate(function(){state.hasSubscription=false;}));}
return state.subscription;};function subscribe(observer){return state.subject.subscribe(observer);}
_super.call(this,subscribe);}
ConnectableObservable.prototype.connect=function(){return this.connect();};ConnectableObservable.prototype.refCount=function(){var connectableSubscription=null,count=0,source=this;return new AnonymousObservable(function(observer){var shouldConnect,subscription;count++;shouldConnect=count===1;subscription=source.subscribe(observer);if(shouldConnect){connectableSubscription=source.connect();}
return disposableCreate(function(){subscription.dispose();count--;if(count===0){connectableSubscription.dispose();}});});};return ConnectableObservable;}(Observable));return Rx;}));
(function(root,factory){var freeExports=typeof exports=='object'&&exports,freeModule=typeof module=='object'&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal;}
if(typeof define==='function'&&define.amd){define(['rx','exports'],function(Rx,exports){root.Rx=factory(root,exports,Rx);return root.Rx;});}else if(typeof module==='object'&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require('./rx'));}else{root.Rx=factory(root,{},root.Rx);}}(this,function(global,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,AnonymousObservable=Rx.Internals.AnonymousObservable,observableDefer=Observable.defer,observableEmpty=Observable.empty,observableThrow=Observable.throwException,observableFromArray=Observable.fromArray,timeoutScheduler=Rx.Scheduler.timeout,SingleAssignmentDisposable=Rx.SingleAssignmentDisposable,SerialDisposable=Rx.SerialDisposable,CompositeDisposable=Rx.CompositeDisposable,RefCountDisposable=Rx.RefCountDisposable,Subject=Rx.Subject,BinaryObserver=Rx.Internals.BinaryObserver,addRef=Rx.Internals.addRef,normalizeTime=Rx.Scheduler.normalize;function observableTimerDate(dueTime,scheduler){return new AnonymousObservable(function(observer){return scheduler.scheduleWithAbsolute(dueTime,function(){observer.onNext(0);observer.onCompleted();});});}
function observableTimerDateAndPeriod(dueTime,period,scheduler){var p=normalizeTime(period);return new AnonymousObservable(function(observer){var count=0,d=dueTime;return scheduler.scheduleRecursiveWithAbsolute(d,function(self){var now;if(p>0){now=scheduler.now();d=d+p;if(d<=now){d=now+p;}}
observer.onNext(count++);self(d);});});}
function observableTimerTimeSpan(dueTime,scheduler){var d=normalizeTime(dueTime);return new AnonymousObservable(function(observer){return scheduler.scheduleWithRelative(d,function(){observer.onNext(0);observer.onCompleted();});});}
function observableTimerTimeSpanAndPeriod(dueTime,period,scheduler){if(dueTime===period){return new AnonymousObservable(function(observer){return scheduler.schedulePeriodicWithState(0,period,function(count){observer.onNext(count);return count+1;});});}
return observableDefer(function(){return observableTimerDateAndPeriod(scheduler.now()+dueTime,period,scheduler);});}
var observableinterval=Observable.interval=function(period,scheduler){scheduler||(scheduler=timeoutScheduler);return observableTimerTimeSpanAndPeriod(period,period,scheduler);};var observableTimer=Observable.timer=function(dueTime,periodOrScheduler,scheduler){var period;scheduler||(scheduler=timeoutScheduler);if(periodOrScheduler!==undefined&&typeof periodOrScheduler==='number'){period=periodOrScheduler;}else if(periodOrScheduler!==undefined&&typeof periodOrScheduler==='object'){scheduler=periodOrScheduler;}
if(dueTime instanceof Date&&period===undefined){return observableTimerDate(dueTime.getTime(),scheduler);}
if(dueTime instanceof Date&&period!==undefined){period=periodOrScheduler;return observableTimerDateAndPeriod(dueTime.getTime(),period,scheduler);}
if(period===undefined){return observableTimerTimeSpan(dueTime,scheduler);}
return observableTimerTimeSpanAndPeriod(dueTime,period,scheduler);};function observableDelayTimeSpan(dueTime,scheduler){var source=this;return new AnonymousObservable(function(observer){var active=false,cancelable=new SerialDisposable(),exception=null,q=[],running=false,subscription;subscription=source.materialize().timestamp(scheduler).subscribe(function(notification){var d,shouldRun;if(notification.value.kind==='E'){q=[];q.push(notification);exception=notification.value.exception;shouldRun=!running;}else{q.push({value:notification.value,timestamp:notification.timestamp+dueTime});shouldRun=!active;active=true;}
if(shouldRun){if(exception!==null){observer.onError(exception);}else{d=new SingleAssignmentDisposable();cancelable.disposable(d);d.disposable(scheduler.scheduleRecursiveWithRelative(dueTime,function(self){var e,recurseDueTime,result,shouldRecurse;if(exception!==null){return;}
running=true;do{result=null;if(q.length>0&&q[0].timestamp-scheduler.now()<=0){result=q.shift().value;}
if(result!==null){result.accept(observer);}}while(result!==null);shouldRecurse=false;recurseDueTime=0;if(q.length>0){shouldRecurse=true;recurseDueTime=Math.max(0,q[0].timestamp-scheduler.now());}else{active=false;}
e=exception;running=false;if(e!==null){observer.onError(e);}else if(shouldRecurse){self(recurseDueTime);}}));}}});return new CompositeDisposable(subscription,cancelable);});}
function observableDelayDate(dueTime,scheduler){var self=this;return observableDefer(function(){var timeSpan=dueTime-scheduler.now();return observableDelayTimeSpan.call(self,timeSpan,scheduler);});}
observableProto.delay=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);return dueTime instanceof Date?observableDelayDate.call(this,dueTime.getTime(),scheduler):observableDelayTimeSpan.call(this,dueTime,scheduler);};observableProto.throttle=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var cancelable=new SerialDisposable(),hasvalue=false,id=0,subscription,value=null;subscription=source.subscribe(function(x){var currentId,d;hasvalue=true;value=x;id++;currentId=id;d=new SingleAssignmentDisposable();cancelable.disposable(d);d.disposable(scheduler.scheduleWithRelative(dueTime,function(){if(hasvalue&&id===currentId){observer.onNext(value);}
hasvalue=false;}));},function(exception){cancelable.dispose();observer.onError(exception);hasvalue=false;id++;},function(){cancelable.dispose();if(hasvalue){observer.onNext(value);}
observer.onCompleted();hasvalue=false;id++;});return new CompositeDisposable(subscription,cancelable);});};observableProto.windowWithTime=function(timeSpan,timeShiftOrScheduler,scheduler){var source=this,timeShift;if(timeShiftOrScheduler===undefined){timeShift=timeSpan;}
if(scheduler===undefined){scheduler=timeoutScheduler;}
if(typeof timeShiftOrScheduler==='number'){timeShift=timeShiftOrScheduler;}else if(typeof timeShiftOrScheduler==='object'){timeShift=timeSpan;scheduler=timeShiftOrScheduler;}
return new AnonymousObservable(function(observer){var createTimer,groupDisposable,nextShift=timeShift,nextSpan=timeSpan,q=[],refCountDisposable,timerD=new SerialDisposable(),totalTime=0;groupDisposable=new CompositeDisposable(timerD);refCountDisposable=new RefCountDisposable(groupDisposable);createTimer=function(){var isShift,isSpan,m,newTotalTime,ts;m=new SingleAssignmentDisposable();timerD.disposable(m);isSpan=false;isShift=false;if(nextSpan===nextShift){isSpan=true;isShift=true;}else if(nextSpan<nextShift){isSpan=true;}else{isShift=true;}
newTotalTime=isSpan?nextSpan:nextShift;ts=newTotalTime-totalTime;totalTime=newTotalTime;if(isSpan){nextSpan+=timeShift;}
if(isShift){nextShift+=timeShift;}
m.disposable(scheduler.scheduleWithRelative(ts,function(){var s;if(isShift){s=new Subject();q.push(s);observer.onNext(addRef(s,refCountDisposable));}
if(isSpan){s=q.shift();s.onCompleted();}
createTimer();}));};q.push(new Subject());observer.onNext(addRef(q[0],refCountDisposable));createTimer();groupDisposable.add(source.subscribe(function(x){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onNext(x);}},function(e){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onError(e);}
observer.onError(e);},function(){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onCompleted();}
observer.onCompleted();}));return refCountDisposable;});};observableProto.windowWithTimeOrCount=function(timeSpan,count,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var createTimer,groupDisposable,n=0,refCountDisposable,s,timerD=new SerialDisposable(),windowId=0;groupDisposable=new CompositeDisposable(timerD);refCountDisposable=new RefCountDisposable(groupDisposable);createTimer=function(id){var m=new SingleAssignmentDisposable();timerD.disposable(m);m.disposable(scheduler.scheduleWithRelative(timeSpan,function(){var newId;if(id!==windowId){return;}
n=0;newId=++windowId;s.onCompleted();s=new Subject();observer.onNext(addRef(s,refCountDisposable));createTimer(newId);}));};s=new Subject();observer.onNext(addRef(s,refCountDisposable));createTimer(0);groupDisposable.add(source.subscribe(function(x){var newId=0,newWindow=false;s.onNext(x);n++;if(n===count){newWindow=true;n=0;newId=++windowId;s.onCompleted();s=new Subject();observer.onNext(addRef(s,refCountDisposable));}
if(newWindow){createTimer(newId);}},function(e){s.onError(e);observer.onError(e);},function(){s.onCompleted();observer.onCompleted();}));return refCountDisposable;});};observableProto.bufferWithTime=function(timeSpan,timeShiftOrScheduler,scheduler){var timeShift;if(timeShiftOrScheduler===undefined){timeShift=timeSpan;}
scheduler||(scheduler=timeoutScheduler);if(typeof timeShiftOrScheduler==='number'){timeShift=timeShiftOrScheduler;}else if(typeof timeShiftOrScheduler==='object'){timeShift=timeSpan;scheduler=timeShiftOrScheduler;}
return this.windowWithTime(timeSpan,timeShift,scheduler).selectMany(function(x){return x.toArray();});};observableProto.bufferWithTimeOrCount=function(timeSpan,count,scheduler){scheduler||(scheduler=timeoutScheduler);return this.windowWithTimeOrCount(timeSpan,count,scheduler).selectMany(function(x){return x.toArray();});};observableProto.timeInterval=function(scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return observableDefer(function(){var last=scheduler.now();return source.select(function(x){var now=scheduler.now(),span=now-last;last=now;return{value:x,interval:span};});});};observableProto.timestamp=function(scheduler){scheduler||(scheduler=timeoutScheduler);return this.select(function(x){return{value:x,timestamp:scheduler.now()};});};function sampleObservable(source,sampler){return new AnonymousObservable(function(observer){var atEnd,value,hasValue;function sampleSubscribe(){if(hasValue){hasValue=false;observer.onNext(value);}
if(atEnd){observer.onCompleted();}}
return new CompositeDisposable(source.subscribe(function(newValue){hasValue=true;value=newValue;},observer.onError.bind(observer),function(){atEnd=true;}),sampler.subscribe(sampleSubscribe,observer.onError.bind(observer),sampleSubscribe));});}
observableProto.sample=function(intervalOrSampler,scheduler){scheduler||(scheduler=timeoutScheduler);if(typeof intervalOrSampler==='number'){return sampleObservable(this,observableinterval(intervalOrSampler,scheduler));}
return sampleObservable(this,intervalOrSampler);};observableProto.timeout=function(dueTime,other,scheduler){var schedulerMethod,source=this;other||(other=observableThrow(new Error('Timeout')));scheduler||(scheduler=timeoutScheduler);if(dueTime instanceof Date){schedulerMethod=function(dt,action){scheduler.scheduleWithAbsolute(dt,action);};}else{schedulerMethod=function(dt,action){scheduler.scheduleWithRelative(dt,action);};}
return new AnonymousObservable(function(observer){var createTimer,id=0,original=new SingleAssignmentDisposable(),subscription=new SerialDisposable(),switched=false,timer=new SerialDisposable();subscription.disposable(original);createTimer=function(){var myId=id;timer.disposable(schedulerMethod(dueTime,function(){switched=id===myId;var timerWins=switched;if(timerWins){subscription.disposable(other.subscribe(observer));}}));};createTimer();original.disposable(source.subscribe(function(x){var onNextWins=!switched;if(onNextWins){id++;observer.onNext(x);createTimer();}},function(e){var onErrorWins=!switched;if(onErrorWins){id++;observer.onError(e);}},function(){var onCompletedWins=!switched;if(onCompletedWins){id++;observer.onCompleted();}}));return new CompositeDisposable(subscription,timer);});};Observable.generateWithAbsoluteTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var first=true,hasResult=false,result,state=initialState,time;return scheduler.scheduleRecursiveWithAbsolute(scheduler.now(),function(self){if(hasResult){observer.onNext(result);}
try{if(first){first=false;}else{state=iterate(state);}
hasResult=condition(state);if(hasResult){result=resultSelector(state);time=timeSelector(state);}}catch(e){observer.onError(e);return;}
if(hasResult){self(time);}else{observer.onCompleted();}});});};Observable.generateWithRelativeTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var first=true,hasResult=false,result,state=initialState,time;return scheduler.scheduleRecursiveWithRelative(0,function(self){if(hasResult){observer.onNext(result);}
try{if(first){first=false;}else{state=iterate(state);}
hasResult=condition(state);if(hasResult){result=resultSelector(state);time=timeSelector(state);}}catch(e){observer.onError(e);return;}
if(hasResult){self(time);}else{observer.onCompleted();}});});};observableProto.delaySubscription=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);return this.delayWithSelector(observableTimer(dueTime,scheduler),function(){return observableEmpty();});};observableProto.delayWithSelector=function(subscriptionDelay,delayDurationSelector){var source=this,subDelay,selector;if(typeof subscriptionDelay==='function'){selector=subscriptionDelay;}else{subDelay=subscriptionDelay;selector=delayDurationSelector;}
return new AnonymousObservable(function(observer){var delays=new CompositeDisposable(),atEnd=false,done=function(){if(atEnd&&delays.length===0){observer.onCompleted();}},subscription=new SerialDisposable(),start=function(){subscription.setDisposable(source.subscribe(function(x){var delay;try{delay=selector(x);}catch(error){observer.onError(error);return;}
var d=new SingleAssignmentDisposable();delays.add(d);d.setDisposable(delay.subscribe(function(){observer.onNext(x);delays.remove(d);done();},observer.onError.bind(observer),function(){observer.onNext(x);delays.remove(d);done();}));},observer.onError.bind(observer),function(){atEnd=true;subscription.dispose();done();}));};if(!subDelay){start();}else{subscription.setDisposable(subDelay.subscribe(function(){start();},observer.onError.bind(observer),function(){start();}));}
return new CompositeDisposable(subscription,delays);});};observableProto.timeoutWithSelector=function(firstTimeout,timeoutdurationSelector,other){firstTimeout||(firstTimeout=observableNever());other||(other=observableThrow(new Error('Timeout')));var source=this;return new AnonymousObservable(function(observer){var subscription=new SerialDisposable(),timer=new SerialDisposable(),original=new SingleAssignmentDisposable();subscription.setDisposable(original);var id=0,switched=false,setTimer=function(timeout){var myId=id,timerWins=function(){return id===myId;};var d=new SingleAssignmentDisposable();timer.setDisposable(d);d.setDisposable(timeout.subscribe(function(){if(timerWins()){subscription.setDisposable(other.subscribe(observer));}
d.dispose();},function(e){if(timerWins()){observer.onError(e);}},function(){if(timerWins()){subscription.setDisposable(other.subscribe(observer));}}));};setTimer(firstTimeout);var observerWins=function(){var res=!switched;if(res){id++;}
return res;};original.setDisposable(source.subscribe(function(x){if(observerWins()){observer.onNext(x);var timeout;try{timeout=timeoutdurationSelector(x);}catch(e){observer.onError(e);return;}
setTimer(timeout);}},function(e){if(observerWins()){observer.onError(e);}},function(){if(observerWins()){observer.onCompleted();}}));return new CompositeDisposable(subscription,timer);});};observableProto.throttleWithSelector=function(throttleDurationSelector){var source=this;return new AnonymousObservable(function(observer){var value,hasValue=false,cancelable=new SerialDisposable(),id=0,subscription=source.subscribe(function(x){var throttle;try{throttle=throttleDurationSelector(x);}catch(e){observer.onError(e);return;}
hasValue=true;value=x;id++;var currentid=id,d=new SingleAssignmentDisposable();cancelable.setDisposable(d);d.setDisposable(throttle.subscribe(function(){if(hasValue&&id===currentid){observer.onNext(value);}
hasValue=false;d.dispose();},observer.onError.bind(observer),function(){if(hasValue&&id===currentid){observer.onNext(value);}
hasValue=false;d.dispose();}));},function(e){cancelable.dispose();observer.onError(e);hasValue=false;id++;},function(){cancelable.dispose();if(hasValue){observer.onNext(value);}
observer.onCompleted();hasValue=false;id++;});return new CompositeDisposable(subscription,cancelable);});};observableProto.skipLastWithTime=function(duration,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){var now=scheduler.now();q.push({interval:now,value:x});while(q.length>0&&now-q[0].interval>=duration){observer.onNext(q.shift().value);}},observer.onError.bind(observer),function(){var now=scheduler.now();while(q.length>0&&now-q[0].interval>=duration){observer.onNext(q.shift().value);}
observer.onCompleted();});});};observableProto.takeLastWithTime=function(duration,timerScheduler,loopScheduler){return this.takeLastBufferWithTime(duration,timerScheduler).selectMany(function(xs){return observableFromArray(xs,loopScheduler);});};observableProto.takeLastBufferWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){var now=scheduler.now();q.push({interval:now,value:x});while(q.length>0&&now-q[0].interval>=duration){q.shift();}},observer.onError.bind(observer),function(){var now=scheduler.now(),res=[];while(q.length>0){var next=q.shift();if(now-next.interval<=duration){res.push(next.value);}}
observer.onNext(res);observer.onCompleted();});});};observableProto.takeWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var t=scheduler.scheduleWithRelative(duration,function(){observer.onCompleted();});return new CompositeDisposable(t,source.subscribe(observer));});};observableProto.skipWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var open=false,t=scheduler.scheduleWithRelative(duration,function(){open=true;}),d=source.subscribe(function(x){if(open){observer.onNext(x);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));return new CompositeDisposable(t,d);});};observableProto.skipUntilWithTime=function(startTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var open=false,t=scheduler.scheduleWithAbsolute(startTime,function(){open=true;}),d=source.subscribe(function(x){if(open){observer.onNext(x);}},observer.onError.bind(observer),observer.onCompleted.bind(observer));return new CompositeDisposable(t,d);});};observableProto.takeUntilWithTime=function(endTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){return new CompositeDisposable(scheduler.scheduleWithAbsolute(endTime,function(){observer.onCompleted();}),source.subscribe(observer));});};return Rx;}));
(function(root,factory){var freeExports=typeof exports=='object'&&exports&&(typeof root=='object'&&root&&root==root.global&&(window=root),exports);if(typeof define==='function'&&define.amd){define(['rx','jQuery','exports'],function(Rx,jQuery,exports){root.Rx=factory(root,exports,Rx,jQuery);return root.Rx;});}else if(typeof module=='object'&&module&&module.exports==freeExports){module.exports=factory(root,module.exports,require('rx'),require('jquery'));}else{root.Rx=factory(root,{},root.Rx,jQuery);}}(this,function(global,exp,Rx,$,undefined){var observable=Rx.Observable,observableProto=observable.prototype,AsyncSubject=Rx.AsyncSubject,observableCreate=observable.create,observableCreateWithDisposable=observable.createWithDisposable,disposableEmpty=Rx.Disposable.empty,slice=Array.prototype.slice,proto=$.fn;if($.Deferred){$.Deferred.toObservable=function(deferred){var subject=new AsyncSubject();deferred.done(function(){subject.onNext(slice.call(arguments));subject.onCompleted();}).fail(function(){subject.onError(slice.call(arguments));});return subject;};observableProto.toDeferred=function(){var deferred=$.Deferred();this.subscribe(function(value){deferred.resolve(value);},function(e){deferred.reject(e);});return deferred;};}
if($.Callbacks){$.Callbacks.prototype.toObservable=function(){var parent=this;return observableCreate(function(observer){function handler(values){observer.onNext(values);}
parent.add(handler);return function(){parent.remove(handler);};});};}
if(!!proto.on){proto.onAsObservable=function(){var parent=this,args=slice.call(arguments,0);return observableCreate(function(observer){function handler(eventObject){eventObject.additionalArguments=slice.call(arguments,1);observer.onNext(eventObject);}
args.push(handler);parent.on.apply(parent,args);return function(){parent.off.apply(parent,args);};});};}
proto.bindAsObservable=function(eventType,eventData){var parent=this;return observableCreate(function(observer){function handler(eventObject){eventObject.additionalArguments=slice.call(arguments,1);observer.onNext(eventObject);}
parent.bind(eventType,eventData,handler);return function(){parent.unbind(eventType,eventData,handler);};});};proto.delegateAsObservable=function(selector,eventType,eventData){var parent=this;return observableCreate(function(observer){function handler(eventObject){eventObject.additionalArguments=slice.call(arguments,1);observer.onNext(eventObject);}
parent.delegate(selector,eventType,eventData,handler);return function(){parent.undelegate(selector,eventType,handler);};});};if(!!proto.live){proto.liveAsObservable=function(eventType,data){var parent=this;return observableCreate(function(observer){function handler(eventObject){eventObject.additionalArguments=slice.call(arguments,1);observer.onNext(eventObject);}
parent.live(eventType,data,handler);return function(){parent.die(eventType,data,handler);};});};}
proto.changeAsObservable=function(eventData){return this.bindAsObservable('change',eventData);};proto.clickAsObservable=function(eventData){return this.bindAsObservable('click',eventData);};proto.dblclickAsObservable=function(eventData){return this.bindAsObservable('dblclick',eventData);};proto.focusAsObservable=function(eventData){return this.bindAsObservable('focus',eventData);};proto.focusinAsObservable=function(eventData){return this.bindAsObservable('focusin',eventData);};proto.focusoutAsObservable=function(eventData){return this.bindAsObservable('focusout',eventData);};proto.keydownAsObservable=function(eventData){return this.bindAsObservable('keydown',eventData);};proto.keyupAsObservable=function(eventData){return this.bindAsObservable('keyup',eventData);};proto.loadAsObservable=function(eventData){return this.bindAsObservable('load',eventData);};proto.mousedownAsObservable=function(eventData){return this.bindAsObservable('mousedown',eventData);};proto.mouseenterAsObservable=function(eventData){return this.bindAsObservable('mouseenter',eventData);};proto.mouseleaveAsObservable=function(eventData){return this.bindAsObservable('mouseleave',eventData);};proto.mousemoveAsObservable=function(eventData){return this.bindAsObservable('mousemove',eventData);};proto.mouseoutAsObservable=function(eventData){return this.bindAsObservable('mouseout',eventData);};proto.mouseoverAsObservable=function(eventData){return this.bindAsObservable('mouseover',eventData);};proto.mouseupAsObservable=function(eventData){return this.bindAsObservable('mouseup',eventData);};proto.resizeAsObservable=function(eventData){return this.bindAsObservable('resize',eventData);};proto.scrollAsObservable=function(eventData){return this.bindAsObservable('scroll',eventData);};proto.selectAsObservable=function(eventData){return this.bindAsObservable('select',eventData);};proto.submitAsObservable=function(eventData){return this.bindAsObservable('submit',eventData);};proto.unloadAsObservable=function(eventData){return this.bindAsObservable('unload',eventData);};proto.oneAsObservable=function(events){var parent=this,args=arguments;return observableCreate(function(observer){function handler(eventObject){eventObject.additionalArguments=slice.call(arguments,1);observer.onNext(eventObject);}
args.push(handler);parent.one.apply(parent,args);});};proto.readyAsObservable=function(){var parent=this;return observableCreate(function(observer){function handler(eventObject){observer.onNext(eventObject);}
parent.ready(handler);});};function handeAnimation(jQueryProto,method,args){var options=args[0];if(typeof options==='number'||typeof options==='string'){options={duration:options};}else if(!options){options={};}
if(args.length===2){options.easing=args[1];}
var subject=new AsyncSubject();options.complete=function(){subject.onNext(this);subject.onCompleted();};jQueryProto[method](options);return subject;}
proto.hideAsObservable=function(options){return handeAnimation(this,'hide',arguments);};proto.showAsObservable=function(options){return handeAnimation(this,'show',arguments);};proto.animateAsObservable=function(properties,options){if(typeof options==='number'||typeof options==='string'){options={duration:options};}else if(!options){options={};}
if(arguments.length===3){options.easing=arguments[2];}
var subject=new AsyncSubject();options.complete=function(){subject.onNext(this);subject.onCompleted();};this.animate(properties,options);return subject;};proto.fadeInAsObservable=function(options){return handeAnimation(this,'fadeIn',arguments);};proto.fadeToAsObservable=function(duration,opacity,easing){var subject=new AsyncSubject();this.fadeTo(duration,opacity,easing,function(){subject.onNext(this);subject.onCompleted();});return subject;};proto.fadeOutAsObservable=function(options){return handeAnimation(this,'fadeOut',arguments);};proto.fadeToggleAsObservable=function(options){return handeAnimation(this,'fadeToggle',arguments);};proto.slideDownAsObservable=function(options){return handeAnimation(this,'slideDown',arguments);};proto.slideUpAsObservable=function(options){return handeAnimation(this,'slideUp',arguments);};proto.slideToggleAsObservable=function(options){return handeAnimation(this,'slideToggle',arguments);};proto.toggleAsObservable=function(duration,easing){return handeAnimation(this,'toggle',arguments);};var ajaxAsObservable=$.ajaxAsObservable=function(settings){var subject=new AsyncSubject();var internalSettings={success:function(data,textStatus,jqXHR){subject.onNext({data:data,textStatus:textStatus,jqXHR:jqXHR});subject.onCompleted();},error:function(jqXHR,textStatus,errorThrown){subject.onError({jqXHR:jqXHR,textStatus:textStatus,errorThrown:errorThrown});}};$.extend(true,internalSettings,settings);$.ajax(internalSettings);return subject;};$.getAsObservable=function(url,data,dataType){return ajaxAsObservable({url:url,dataType:dataType,data:data});};$.getJSONAsObservable=function(url,data){return ajaxAsObservable({url:url,dataType:'json',data:data});};$.getScriptAsObservable=function(url){return ajaxAsObservable({url:url,dataType:'script'});};$.postAsObservable=function(url,data,dataType){return ajaxAsObservable({url:url,dataType:dataType,data:data,type:'POST'});};return Rx;}));
