var externalContentLoader=(function(b,q,d,j){var p={DEBUG:1,INFO:2,WARNING:3,ERROR:4};var k=q;var h={};var o=this;var c="";if(!window.logCustomParamsByContType){window.logCustomParamsByContType=[]}var n=[];k.abTesting="zoomd";if(SphereUp.SphereUpWidget.defaultOptions.platform&&SphereUp.SphereUpWidget.defaultOptions.platform==="codefuel"){k.abTesting="perion"}var a=function(r,e){if(r==e){return 0}return r<e?-1:1},i=function(s,e){var r=a;if(s){r=function(u,t){return a(s(u),s(t))}}if(e){return function(u,t){return -1*r(u,t)}}return r};j.sort_by=function(){var e=[],r=arguments.length,v,s,u;for(var t=0;t<r;t++){v=arguments[t];if(typeof v==="string"){s=v;u=a}else{s=v.name;u=i(v.primer,v.reverse)}e.push({name:s,cmp:u})}return function(y,x){var H,G,w,F,I=0;for(var D=0,z=r;D<z;D++){I=0;v=e[D];w=v.name;F=v.cmp;if(w.indexOf(".")>0){var E=w.split(".");H=y;G=x;for(var C=0;C<E.length;C++){H=H[E[C]];G=G[E[C]]}}else{H=y[w];G=x[w]}I=F(H,G);if(I!==0){break}}return I}};if(!window.hidePlacement){window.hidePlacement=function(e){window.postMessage("hidePlacementAd:"+e,location.href)}}j.waitFor=function(r,t){var s=0;var e=setInterval(function(){s++;var u=r();if(u){t(u);clearInterval(e)}if(s==6){clearInterval(e)}},500)};try{h=JSON.parse(k.AdPlacements);h.sort(j.sort_by("name",{name:"settings.position",primer:parseInt},{name:"settings.width",primer:parseInt,reverse:true}))}catch(g){h=null}if(!k.hasOwnProperty("widgetMinorVersion")){k.widgetMinorVersion=d.internalConfig.widgetVersion+(d.injectionSettings.isMobile?".mobile":"")}if(k.ExternalContentFramework){j.loadScript(Zoomd.Widget.SU_BaseUrlContentHttp+"/common-scripts/jquery.dfp.min.js?v="+d.internalConfig.thirdPartyVersion,"dfp",function(){if(window.jQuery.dfp){b.dfp=window.jQuery.dfp}})}this.getNoIframe=function(C,y,D){var x="";var z={};var E,s;var t;var B=y.url.split("?")[1];var A=B.split("&");for(var v=0;v<A.length;v++){var u=A[v].split("=");if(u[0]&&u[0]!=="abTesting"&&u[1]&&u[1].length>0){z[u[0]]=decodeURIComponent(u[1])}}function r(H,I){var G=b(H.target);while(!G.hasClass("zd-nfr")){G=G.parent()}var F=G.data("conttype");if(F&&typeof(F)=="string"&&F.length>0){I.containerType=F}return I}function w(){var F=b.Deferred();var G={url:y.url,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"html",beforeSend:function(){var H=1;t=setInterval(function(){z.timeSecondsDelay=H;l("AdsCMSDelay",z);H++},1000)},timeout:30000,success:function(H){if(!H||H.Error){F.reject(H)}else{F.resolve(H)}},error:function(H){F.reject(H)}};b.ajax(G);return F.promise()}function e(I,G){var J=b(I);var H=0;var F=setInterval(function(){H++;J=b(I);if(J.get(0)){G(J);clearInterval(F)}if(H==6){clearInterval(F)}},500)}(new w()).done(function(N){var G="";if(y.height){G="height:"+y.height+";"}var O="#zd-nfr-"+C+"-ps-"+y.position+y.contAdName;E=b(O);E.addClass("zd-nfr").attr("data-conttype",C+y.position);var I=true;clearInterval(t);if((/%AdsCMS.NotAvailable%/g).test(N)){if(C==="404Disc"||C==="M-404Disc"||C==="ts"){E.parent().remove()}if(E){E.remove()}var F=E.data("conttype");if(F&&typeof(F)=="string"&&F.length>0){z.containerType=F}l("AdsCMS_NotAvailable",z)}else{if(!window.PushLogParam||!SUPJQ.isFunction(window.PushLogParam)){window.PushLogParam=function(P,Q,R){if(R){logCustomParamsByContType[R]=logCustomParamsByContType[R]||{};logCustomParamsByContType[R][P]=Q}n[P]=Q}}if(!(/%AdsCMS.DisableAdDisplayed%/g).test(N)){E.on("zoomdSearch:adDisplayed",function(P){l("AdDisplayed",r(P,z));if(SUPJQ.isFunction(D)){D()}})}if(!(/%AdsCMS.DisableAdProvided%/g).test(N)){E.on("zoomdSearch:adProvided",function(P){l("AdProvided",r(P,z))})}if(!(/%AdsCMS.DisableAdClick%/g).test(N)){E.on("click",function(){var P=E.data("conttype");if(P&&typeof(P)=="string"&&P.length>0){z.containerType=P}l("AdClick",z)})}N=N.trim('"').trim("'");if(y.NoiFrame===2){var L=function(P){if(P&&P.length>0){P[0].write('<!doctype html><html style="height:100%;width:100%;margin:0;"><head><base href="'+Zoomd.Widget.SU_BaseUrlServiceHttp+'"></base><script>inDapIF = true;inFIF=true;iFrameSrc="'+y.url+'"<\/script></head><body style="height:100%;width:100%;margin:0;">'+N+"</body></html>")}};var K=function(){var P=b('<iframe src="" frameborder="0" scrolling="no" style="height:100%;width:100%;margin:0;" />').appendTo(b(O));if(P){var Q=P.contents();if(Q&&Q.length>0){L(Q)}else{j.waitFor(function(){var R=P.contents();if(R&&R.length>0){return R}return null},L)}}};if(b(O).get(0)){K()}else{e(O,function(){if(b(O).length){K()}})}}else{if(E.get(0)){E.html(N)}else{e("#zd-nfr-"+C+"-ps-"+y.position+y.contAdName,function(){if(E){E.html(N)}})}}var H=function(){if(s){s.before(E)}I=false;if(SUPJQ.isFunction(D)){D()}};if(s&&s.length>0){H()}else{if(s){var M=0;var J=setInterval(function(){M++;if(s.length>0){H();clearTimeout(J)}if(M==6){l("ad_not_shown_missing_element",z);clearTimeout(J)}},500)}else{if(E&&E.length>0){H()}}}}if(I&&SUPJQ.isFunction(D)){D()}}).fail(function(F,H,G){clearInterval(t);if(H==="timeout"){l("AdsCMS_timeout",z)}else{l("AdsCMS_error"+H,z)}if(E){E.remove()}if(SUPJQ.isFunction(D)){D()}})};this.load=function(G,E,A,C){var y=[];if(typeof(h)!="object"||b.isEmptyObject(h)){return y}var w=screen.availWidth;var B=2;if(w>540&&w<880){B=3}else{if(w>881){B=4}else{if(w<300){B=1}}}function H(I){return I?(B<I?B:I):null}function D(I){if(I){if(!isNaN(I)){I=I+"px"}if(!(/[0-9]+px$/).test(I)){I=null}return I}return null}function F(J,I){if(!isNaN(J)){var K=jQuery.grep(I,function(L){return L.settings&&L.settings.width&&L.settings.width<=J});return jQuery.grep(K,function(M,L){return L===0||M.settings&&M.settings.position&&M.settings.position!==K[L-1].settings.position})}return I}window.zoomdPlacementsLoaded=[];function e(Q){var M=Q.name+Q.settings.position;var L="zd-dfp-"+M;var O='<div class="zd-dfp-unit" id="'+L+'"  data-adunit="'+(Q.settings.adunit||M)+'" ';var P=Q.settings.height||(E&&E.height);if(P){if(isNaN(P)){P=P.replace("px","").trim();if(isNaN(P)){P=null}}}var J=Q.settings.width||(E&&E.width);if(J){if(isNaN(J)){J=J.replace("px","").trim();if(isNaN(J)){J=null}}}var I=Q.settings.dimensions;if(P&&J){I=J+"x"+P}if(I){O+='data-dimensions="'+I+'" '}var K=Q.settings.targeting;if(typeof(Q.settings.targeting)=="string"){try{K=JSON.parse(Q.settings.targeting)}catch(N){}}if(typeof(K)=="object"){b.extend(K,{clientId:d.injectionSettings.clientId})}else{K={clientId:d.injectionSettings.clientId}}O+="data-targeting='"+JSON.stringify(K)+"' ";O+="></div>";j.waitFor(function(){return b("#"+L).length},function(){var R=zoomdPlacementsLoaded.indexOf(M);if(R>-1){array.splice(R,1)}if(!I){if(b("#"+L).height()<=0){b("#"+L).height(P||90)}b("#"+L).height(Math.floor(b("#"+L).height()));b("#"+L).width(Math.floor(b("#"+L).width()))}try{b("#"+L).dfp({dfpID:d.internalConfig.dfpId,afterEachAdLoaded:function(T){var U=b(T).attr("id").replace("zd-dfp-","");if(b(T).hasClass("display-none")){if(window.hidePlacement){hidePlacement(U)}}else{if(zoomdPlacementsLoaded.indexOf(U)===-1){zoomdPlacementsLoaded.push(U);l("AdDisplayed",{containerType:U})}}}})}catch(S){j.sendLog(S.message,"ERROR")}});return O}var s="";var z="";var v="";var x=0;var t="";if(E){if(E.name){z="_"+E.name}if(E.width){v+="width:"+E.width+";"}if(E.height){v+="height:"+E.height+";"}if(E.query){t=E.query}}var r={};var u=h.filter(function(I){return I.name===G});if(E&&E.posibleWidth){u=F(E.posibleWidth,u)}u.map(function(I,J){if(I.hasOwnProperty("name")&&I.name===G){if(!I.settings){I.settings={}}if(isNaN(I.settings.position)){I.settings.position=""}if(k.ExternalContentFramework&&b.dfp){s=e(I)}else{if(I.settings.hasOwnProperty("NoiFrame")&&I.settings.NoiFrame){I.settings.url=m(G+I.settings.position);I.settings.columnSpan=H(I.settings.cardSpan);I.settings.height=D(I.settings.height);I.settings.contAdName=z;I.settings.id="zd-nfr-"+G+"-ps-"+I.settings.position+z;o.getNoIframe(G,I.settings,A,C);if(I.settings.NoiFrame===2&&I.settings.height){v+="height:"+I.settings.height+";"}s='<div style="'+v+'" id="'+I.settings.id+'"></div>'}else{I.settings.id="zd-fr-"+G+"-ps-"+I.settings.position+z;s='<iframe id="'+I.settings.id+'" src="'+m(G+I.settings.position,t)+'" frameborder="0" scrolling="no" style="'+v+'"></iframe>'}}r={};r.columnSpan=H(I.settings.cardSpan);r.height=D(I.settings.height);r.width=D(I.settings.width);r.position=I.settings.position;r.settings=I.settings;r.html=s;if(z!=""){r.contAdName=z}y.push(r)}});return y};function f(s){var e=Zoomd.Widget.SU_BaseUrlServiceHttp+"ActionSearch2?";var r=b.map(s,function(u,t){return t+"="+encodeURIComponent(u)});return e+r.join("&")}function l(s,t){var r={timeSeconds:(new Date()).getTime(),action:s};if(t&&t.containerType&&typeof(t.containerType)=="string"&&t.containerType.length>0){r.containerType=t.containerType}if(t){r=b.extend(r,t)}if(window.appInsights&&b.isFunction(window.appInsights.trackEvent)){window.appInsights.trackEvent(s)}if(r&&r.containerType&&logCustomParamsByContType[r.containerType]){r=b.extend(r,logCustomParamsByContType[r.containerType])}if(k.Version){r.ver=k.Version}var e=false;if(window.Zoomd&&Zoomd.Widget&&Zoomd.Widget.zdlogger){e=Zoomd.Widget.zdlogger.logEvent(s,r)}if(!e){j.sendLog("logger missing in ECLoader","WARNING");b.ajax({url:Zoomd.Widget.SU_BaseUrlServiceHttp+"LogClientAction",data:{clientId:k.clientId,action:s,eventData:JSON.stringify(r)},type:"POST",dataType:"json",success:function(u){},error:function(u){j.sendLog("LogClientAction failed","ERROR")}})}}function m(e){var s=d.zdlogger.getSessionParameters({containerType:e,itemType:"AMPCard"});var r=f(s);return r}return this});